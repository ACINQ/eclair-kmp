package fr.acinq.lightning.serialization

import fr.acinq.bitcoin.Transaction
import fr.acinq.bitcoin.byteVector
import fr.acinq.lightning.CltvExpiryDelta
import fr.acinq.lightning.Feature
import fr.acinq.lightning.Lightning
import fr.acinq.lightning.blockchain.BITCOIN_FUNDING_DEPTHOK
import fr.acinq.lightning.blockchain.WatchEventConfirmed
import fr.acinq.lightning.channel.*
import fr.acinq.lightning.channel.TestsHelper.processEx
import fr.acinq.lightning.channel.states.WaitForFundingConfirmedTestsCommon
import fr.acinq.lightning.tests.TestConstants
import fr.acinq.lightning.utils.UUID
import fr.acinq.lightning.utils.msat
import fr.acinq.lightning.wire.ChannelReady
import fr.acinq.lightning.wire.UpdateAddHtlc
import fr.acinq.secp256k1.Hex
import kotlin.test.*

class CompatibilityTestsCommon {
    @Ignore
    @Test
    fun `generate data`() {
        // generate test data
        val (alice, bob, fundingTx) = run {
            val (alice0, bob0, txSigsBob) = WaitForFundingConfirmedTestsCommon.init(ChannelType.SupportedChannelType.AnchorOutputs)
            val (alice1, actions1) = alice0.processEx(ChannelEvent.MessageReceived(txSigsBob), minVersion = 3)
            assertIs<WaitForFundingConfirmed>(alice1)
            val fundingTx = actions1.find<ChannelAction.Blockchain.PublishTx>().tx
            Triple(alice1, bob0, fundingTx)
        }
        println("funding_tx: ${Transaction.write(fundingTx).byteVector().toHex()}")
        val bin = Serialization.encrypt(TestConstants.Bob.nodeParams.nodePrivateKey, bob)
        println("wait_for_funding_confirmed: ${bin.data}")

        val (bob1, actionsBob) = bob.processEx(ChannelEvent.WatchReceived(WatchEventConfirmed(bob.channelId, BITCOIN_FUNDING_DEPTHOK, 42, 0, fundingTx)), minVersion = 3)
        val channelReady = actionsBob.findOutgoingMessage<ChannelReady>()
        assertTrue(bob1 is WaitForChannelReady)

        val bin1 = Serialization.encrypt(TestConstants.Bob.nodeParams.nodePrivateKey, bob1)
        println("wait_for_channel_ready: ${bin1.data}")

        val (alice1, actionsAlice) = alice.processEx(ChannelEvent.MessageReceived(channelReady), minVersion = 3)
        assertTrue(alice1 is WaitForFundingConfirmed && alice1.deferred == channelReady)

        assertTrue(actionsAlice.isEmpty()) // alice waits until she sees on-chain confirmations herself
        val (alice2, actionsAlice2) = alice1.processEx(ChannelEvent.WatchReceived(WatchEventConfirmed(alice.channelId, BITCOIN_FUNDING_DEPTHOK, 0, 42, fundingTx)), minVersion = 3)
        val channelReadyAlice = actionsAlice2.findOutgoingMessage<ChannelReady>()
        val (bob2, _) = bob1.processEx(ChannelEvent.MessageReceived(channelReadyAlice), minVersion = 3)
        assertTrue(bob2 is Normal)

        val bin2 = Serialization.encrypt(TestConstants.Bob.nodeParams.nodePrivateKey, bob2)
        println("normal: ${bin2.data}")

        val add1 = CMD_ADD_HTLC(
            10_000.msat,
            Lightning.randomBytes32(),
            CltvExpiryDelta(144).toCltvExpiry(TestConstants.defaultBlockHeight.toLong()),
            TestConstants.emptyOnionPacket,
            UUID.randomUUID()
        )
        val add2 = CMD_ADD_HTLC(
            10_000.msat,
            Lightning.randomBytes32(),
            CltvExpiryDelta(144).toCltvExpiry(TestConstants.defaultBlockHeight.toLong()),
            TestConstants.emptyOnionPacket,
            UUID.randomUUID()
        )
        val (alice3, actionsAlice3) = alice2.processEx(ChannelEvent.ExecuteCommand(add1), minVersion = 3)
        val (_, actionsAlice4) = alice3.processEx(ChannelEvent.ExecuteCommand(add2), minVersion = 3)
        val htlc1 = actionsAlice3.findOutgoingMessage<UpdateAddHtlc>()
        val htlc2 = actionsAlice4.findOutgoingMessage<UpdateAddHtlc>()

        val (bob3, _) = bob2.processEx(ChannelEvent.MessageReceived(htlc1), minVersion = 3)
        val (bob4, _) = bob3.processEx(ChannelEvent.MessageReceived(htlc2), minVersion = 3)
        val (bob5, _) = bob4.processEx(ChannelEvent.ExecuteCommand(add1), minVersion = 3)
        val (bob6, _) = bob5.processEx(ChannelEvent.ExecuteCommand(add2), minVersion = 3)
        assertTrue(bob6 is Normal)

        val bin3 = Serialization.encrypt(TestConstants.Bob.nodeParams.nodePrivateKey, bob6)
        println("normal_with_htlcs: ${bin3.data}")
    }

    @Test
    fun `read compatibility test data`() {
        // data was generated with lightning-kmp v1.5.0
        // README: it this test fails it means that we cannot decrypt and/or deserialize data created with an older version of the app !!
        val fundingTx = Transaction.read(
            "0200000000010276058fd30a4a3fe70d25a35eb61401a3a8f3b2cd5f6bd421ef231050f6548cd1000000000000000000f09e5714368a431b191699d902528336f14a439d9121e34684c06c810cd8671e0000000000000000000140420f000000000022002033120e2909907ce750a4325af2760346238eb32e0d5835ef4eab0b6224c77aed0247304402207677fae543aaa274ab50a96a2b7007ca185a36a9ba781459576bce83c298b4bc02201d0335529c5c869e2f1afc206df6a1c6ffb0ab7648c6c8edfb03c56a7e59f94001210367cfaf859c730721387256cc5c0ababf13941224ffb80cb7c1a5f733a29c3fc302483045022100de5a19af175979ce097c3fb7e64fca50d3ab41c24d56418745063072d5678605022039e7e2337b34c46d501701d17f0e359459cbc245848a829433ff2b2920078dd4012102bfb834501e40a39d7f43367a0f7844cff179f607f59b31059cb071f90d73a1df801a0600"
        )
        val waitForFundingConfirmed = Hex.decode(
            "81682f981b40ef57987bf9d6fabeeafe5e5a539970123d7e32b8fc3c73b5aa9af21faf87e9d8e9e295bed6aa4e92d2a908d2f3d6bafed8a85aa4bc0cc61a7113220547ccd87034393385e4ce0c47083cfef283e46e86d28f9959cffb7b98c71271582f405b51e10728347a2ce9d08ea8b1c91681d606b41219db0b269e6885ed6a8134b5362a10c1110ba282337186e6cc12c86c73932007bbc586aef5529efd1216c377c29866a24a1d3eac24d72f249bb53381b5cfeb1c1f20a905338775fea4353799ffb28108be04ef811844e8eec0351db743d96705dce148a24eabd9f9c49799318c4dbed110d3e9b9cb4d4d0452052f224306597908cfab6d07869c67b32d17589532b072f41f953626fd66548b4f00010121e9dee3209ec22250cce05fdc75e15876503b8e00874e1e2b10f738e708cd4b7aa029028a1ac39c29d684c3d1dfcbb7ad6503fe4187f5608a1e68a60661875bfc74b3d64bfda6dd36f43308a68cf6561009afe4babeded75a34429c2df81d519498976fc8a91f77715e0a9b930732eaf6b6900abac707e235ee9c02dd3f66357890b2f712b0f95866c22ab5f0934c00f42d205d78ced07785311c88f13b0d0315b0b6cb2b20bf6e91d11fe1f8540bd2914a0a7edb63f5c9f2c97b08fe14a33fb992a2d3c47fc76384fc2e2640219360ad9c34683a7b95350ced028fce9db545c7864d5f927cccd1a03e0e9b556b3e441cdfdd67a6c8557dbbac0f48edc2db07a00ad012e70738487e5173ba65832381357167fc067a43cb17a1feed29ad670a08a908989001f4247016e6ca25fdd90e1b002ce4850f43fd5a090298eec6387768cec9dfa8843e0fd45e410d0ec06282c98a50e29d2634957d3bb4981e7941c3b7cd59cd972ba568843583359700d8226ffce37f58c02a4ebad8b8bb7d7e82d171f39fadfd9a01f0e649f4fdeae90ab8d5b0ff1dd0314f023e72a654d4b53114b22395d1d02acae7eee39acfa0c9ad1b9a10fde1b6cf46021a62c520a3eecfc7c1846ba698a37f971a3d5a6102af259c88c9b2d208ce639e390198347181bb0317629ddb3bcda554444534c09b5b6baa9fcb6049db976cad3400b4d017e27d355ea294c21ac552f919dbeefa832b280a974fffcb40ce8829db86110564e3a14e7a1c1b3cd36ce9ac30fbc25d6d157daa8e2e5dd3cb12fdf0057d2e5aac40adb542ae5b26d38b17bf76117370b77bea9a9661712552913b2e05eb2dfc371c4e45517cdbc33aed3f73ba96c32ca89777ecd03e2dbb39ab5f854333b2210a5b75dfd00868442765c8f01e261af5729d67a1deab6197f0c8a592f541c3d43b847ad107d81b7d73fca1c35793ff37d06a78fb66a30cf4d754f2004c571314b5baa1422bd0c4557d36b339ea233e605fdcead4bb54c02bb3441ccf1a6e3779fb30c372617610ef8f57fd88e1b1164e8ba139ffb11b3b7ff41fa245b016826eb62047487ac7762e5a232cc24980065663130bc1a227e658769f1db8e62f6829a7735a365cd7f5d17d89e1f50f59cc05d57fab703d8ff1523155046841a0277b76daa8407212ce920ee90bac1287af23e0eaffde746fef240163b1fd2dc84227b2d51f65dd1ca0d7cac5930d32693098bea0b63b6b5e355e8d6a6a270bf68af36804b985124cb663839a5e99bdbe06648708271e2351bcab7f053a921f01baa2e4a716f661fd276339eccb97f9da1d6968c847d4f9e05d3fd7cc2e3622a5d35480f0622e05f5b6c62dff8937fd451c7ab63975b7ea73bda87ff4555a46a78ef65b5493f9f31e11bd80e5fc6236cbf0dd761c496103a0298ea270720f6cd4a6aa9b645d419d8a0c113d4e6921a4e2f95a752063c275ce56485121571e2ba43d209145815aa62d26e84d22bbd29ec1b1eb8b6dac199eb106ebc49bb30303ee169fd319e5baa81a0be933e29c2c8608c899f6970201168d7d9626a8f87e3aeaa160b18ee73251dfdd039a2b28954e9fe075ed9e625384019cfd3fa4aa855b68629532f514350edb49b6f8f47b453b109db7837004c659a0f8d9d0ee9d270b6f12603ae05f1ad686764d919f25301810b18f8639777c484ccd0302091174e86e8124b63da71ca0191b96dfb8f006b6343da5cc2d5ecf8b92e65146b6ed7ffec450a578c5fae1258731e80c67f0c635de6a72f641d87d9fe587f7ea2c0f40b05ca8c13a1ae5752252157924834918b174d6fff9328e315602cd84524d3d0522e5364a9c62a95674eac182c2063b46f0af3ad4b7d333c80d752cef3a54132686152bbd1dec0b49283435115424059c08ad10a3123a5f9e75ae7baf6ddf2f3620baae53220a69c1db755d1e30ee1190c2f80e1de090294edac35af1b4fd9562d979aed9b51acc62bf75106d094b3df5e6a5f426992c5e291793aadc78575ca8e1b79e407eea6e5c336df9b6adc578f93815dac11141be3f13f6667ef41f554e9c095da401e855d05a3d0c4ed73533a5c70d137d632f6eeb9ffb6a7e9352744504a36c430551cd3967761fda115b6e89d03d04b1091b618a9ce6c2b6d82cdc712035f52171f2e6ad427ec84747858399e87154ba295ac08e00e69308793716c886485136a9a3b8b38f1c820c8b00dcd0c353140e3112207c97a681566115aa0537dee7031d5f9f234a87bb2876f15cc7016b1199ecd29040d364cee3c0b1d6bf46518a19c2029e155c0dbb57e3e360b524548b7edea6da7767b8674c150360d69bb4f9df8a17aac2d88f1aad3b2dfadb26436421b9935a18dc226ea2891c593485d00ac584d40ab8a1df024371180d3083bc1d67205cd145e98655de189b9a187e092595ac7c3a6b0f1b1d32b6130ebe9b04cd2d8ea85763e3e4c376eeba251c2f26bc46d07c58ad77d49840ec8fa059a7a108f147bd0a912517950170197a0d7f9943e20a3d33df2894bc800443fe7e818ba2af4f81da78cac1366104189934571cf52ebc43d9bd69f1afed0855bbe160abdbe11c8775554733b7938501820ccfbe8a29820f0b15c45252119f9423113905b9fbfdb7d9f7f223e36294bde1f6d5dbeed13f946300120d1f12bf5780d1fd0185ddd57f903b327d4f03ae2c122b1e37efcc52af3696924250b9c88881b0920f840eb752c02f5da8252ac42c409fb801d8fc2252ecc6b4e67653d7e75298e77b181a2992d05afbcca648e75594025b8faf99d0b430907aeb49c8379b73e2c3a89c591301ea33395597422c57c2c694e8b26b469e608518f57cb6ddaea64287963751b8bdebe4292293b765eeb389d785bfba6020a8ac00730b99bb7586e620b90e4034aa591a2bf273a5f0177cd48e579743464f9750a5389df5893c02eb665956ed8f6d2d3d734b4c32af8febc0eace34420cba3d05a085e9079036f8f66d06eab4896db27af72beb2f2048614634cea905a597d7962a05ca0eb391e98db9600afc1d92dbf21da533473ef64a381842373078375289c46fad9522e5cb43e4e9bb60bb7bebcba3f5a4e58ae5470ac84d398f59e7d55a0497af63236339497a03940a57b6b5ffa5639e72da3ae23ab037c100944a432f54a55ae3e59ed2620c5aea6ed716c05a3666c945f974252fe1c32129f05a3d2b5778944ee22317e18e92868a69d962dca21f0c0f549ed57c54678c9aa89dec4c52b3846e2c1d37a8851ef7f5effba3e8c7569edf12da64d477a3c56ebc70ff2b223bdf1a773d1c37e7a24b559de136085237964d5c7adb103fd94255c92d8f9d42264ab96225be3a8e52ce6baa3ea7f6a96162cd8ce47b41db71d74f72db737680781cd2e0d169ee2daf4ee7074e9d8d262b1d23364e44ed45b29bce992f982e00119ebed860f8c2ed056e62708aa9502c07e4826a4ce382874678d3a3e4dd8fff1e650041db58292f52611600ca2326bf7fca5681b49d7dc63755e23843f97075beb8daab028c69f69aac421c7f1ebc4b16632cab5269200cd37779e8f4ba371374cdc20fedee86d6675e06a65e1abad0207bd494274860f9ffb441ea08f21a62b950b2f143b6894c5d4094a8d445cfaaab52ab5df7a230575247cb69c93b210e4c65ad67139c50c22b4cf901d7c79d5e137ba3dfac3a6df372cebb767b4c3f9da2902baa31abfa430c9f2ae3fac4c9b6ff5ff66df1f5c8b4738095f237744c2878650bc2a9065b811c25bae0f03bfcaf33c5549ccc444040f7854cde2f3fd7b8863ae212617a6fd0a6e4aea6a9896c85e75100bcb6a6ba6184c262bd056997b4ac989f0632e919246d65eb3080bc0a5bdbbd20d5fcab1154141ccdf708905f4829d1b7a9908272809366a65abfc2015b7389958d9ce608b5e1b37136064007897448fbaf8dfa62fe3148b3b11986713e6ad7f329c24dc4cf127533a1520ae799952f89e71455c2ae27d2bb356eec203a6a2f3b900686fa7fe2a9b480f41a84b55c29de4c7da7b1ccc834346ed97acae915b8e88f753c348af265499c23b1c1c32cef97af426249750bba26bad2612f6ea99694be9baa4e0da1ed41b6a521b9bae629ec84ed628b5f8330f45cfcf9f28b1858d5fad7604d1979ec971414a64b1c9a31dcabf3909a51ceb6da4cd4f6a5f96b99bf5115027059a38183e46d5ab08377759bcbf9aa0f18d0590e9f31b7e30ccd68098edff542830586874f79c6456030bea42123a1598047afc3c4319dfc2a307c55bb5c096fd0382d439142fdd8994c943fb19de68a6cba4edb00b0da6853d632c10aa016fab407776bb42505e876878668813baf3793dc4fdc0b60a04e1b011cbcb1e053578fbf65f05db4d80ddc25e86e492eea4396abd6845818e8db71d02fbe3582f1f3b586a9df239383749878ac3fc3d7e453badb95318347903ba69ceb710740154a11d96619117d84db459f0eda01dc6b0b5fd7905cd32bf2f8d15c73b7e1d4d772e69065c48e754d004fe97ef6e938676483a09a90b77d84add77b85583009b504ad1e13f5a82e8289f7c62af5484b1024cc80f2552a09a19e38bd589c78d6082538d31144ed9c9266b50d5f4bb1f2edfb53d462c4a5ea64d7388ec2812ba0eee919b441f4350516e109ed5d74e84ff2d315b7fe20bba19422e29334d6e65e785e89af6db1ddde8c636eb1be663c3c19fe2cbde1ab1609dcce9d9949caa22168d4774efdf899b1f7ff8defd0e4957c7663842d9c1913f85ec4783ea3c6ca56ecafcb6ad33550841e3c7067e28ba805ce533d8613ccad9b0e39bd9f9a1f5b280462184c3c292fc7700e94c6106ac816da86c3bd6bd21a5f8abee3206219a8ef64ab8b07f22f4dc1dc1c44c43aa58d20ebc19aacafb40a384c95933f816f923964ff4759c0de637677fbfeaaf9616c60f324456ce67d745150f45d792ae50e9863096b59198599a9533c47596ea84e409f6ab228729e9e8e458fdc0248c042c42f4f879483086f7c52d204c19cc2328e0c8b573dcbc90959d16ffaa165ec9c71b99e301191edd29e43b81cd23fd6ae4ea27be11e0047dff0e696de4791f76c513bbe29a243785e55859f50dff956b982b5115d7fa0fdf895d9584858c2eb98a725cd49a1900c20d4002aa912c872a050690ec77e6fe46c31a99ff19d7bfe88e0d03c5c3b00e691d40f653872ed92f5363c48f9cd040917bbe67aa0c04e68a8ac56d55ac01b5d37fab498602d721fa1189dc65166eacfac7f5c59018a3b77f650a832692a0e3bc908bb99355595a3dc97b4ba4f0c5c03578476b27964066b415fbb38e57e8850478d0a3942c4f0a24d948a5fd14f4a9e9d7be252375ae944ad116ed9feb78de0b2f5832e1e10bf746ed4a9492b8207e4c274a84a156a52f3ea20323904f4c26913a205d27e3bd805897eed1e452f911aaaa1fbd6800b1ad0bd3267ced6cb0e8923281cbc040bf1441b98f7dbd2b2ce32ab4186edb0306d33d2702a63c8ffb5cd90675442333e46f9a871b5cbbb27e016b15ef447abe56be0988a3cde579de344bc916c90b0d3a427ea641f17af977491c064d834bd045394cccc608269bc9e51bf4203534804415721cc7b292872033bd769524ebff4039aa8bdecfa17be9c5890e47459c89a50c1ba17df5709ad59f8fdd3c0984441221be10023192cf21e1e48609e3078f68a22fffb7075c8478906106879cdddc8e07f7dc34cfbc86459ee6135e7911c66d46d4cbad62591bf85fd1ea5bef54a8b9a66d9b94aa39b134fa96f40833e5d37cfb5dbf11747c24c51c4e76b85c9b0562e6aa4175fbe14d268ee2a929acdceae831e160a38e3b20fc0e8e54c510eb5b559c679a3a727b07d81ffcfb34b786723e0530e32f1a44231f2a18f9dc96bfc8d9cbef7b3ea1ec70b27dae7cd2b4b1bb7397681c48925b0fd2087ea1eed0f61d7a5f1d70e9d28a9a34f63caa2b2fb67e07377f069d7b703fea45ae80ce526c78432dedaa2c9a751bb62b4bae4b4e00784538b699d2fd504bc94cfe1e8e0809f023fb8088e4db551c07257df2ae128caf6b3ada4bfc3fe442d4a3e25682684c5fbc9e09019739a13d17cd7cd8e68a8e91ca628bacb41e45fb3c4012d95029255d8474a4dd5b73c7b029dc8d78b630f2c3a31a53d74191a121e8bd224baa65abad3c284275b05040325f287c9a0f693ede9886e630f1d8b1fda7714362687c9cc5d07b9760e996e4871a87a4beb"
        )
        val state = Serialization.decrypt(TestConstants.Bob.nodeParams.nodePrivateKey, waitForFundingConfirmed, TestConstants.Bob.nodeParams)
        assertIs<WaitForFundingConfirmed>(state)
        assertEquals(state.commitments.fundingTxId, fundingTx.txid)
        assertEquals(state.commitments.channelFeatures, ChannelFeatures(setOf(Feature.StaticRemoteKey, Feature.AnchorOutputs)))
        val waitForChannelReady = Hex.decode(
            "fd8432391e4d508617288dcc15d63397f5e0e39eb080ebbf79cfd8cfe188aa51a9e95e509341dc640e00878ac87312efaec22747d3075261bfb7dd1750e903b30c8b48d982249c9b7bc60f4ce289a9d93d110a0787014edeb28b978256be711c5faf944b94bd442f6858688334a07da4e063529141fad8f180ebded19240f95fd703db032ca09d8febaeb5daf276a3ba922b02cd6f562fd710a7f16e4173bb6d459169e222055d90a0ed4cd5e1702f3bd55cf6719b32ef124e42c6e056d1e25ef524921a3a12fdf6685723983c11bbea95269cde16e970a2af8aee8c0826ac4611af2a88097f4e6b641f162bbc2cd4be7b1987a6022a7d8320578a649d2e4702c279cef0219cea7d2e397d382879ca967e854c303096088f0de32c714a90a356c9343e8b3abb27ef6728953e937fd7b68177b1bfeb722fabb8724888faaaa1c7faf90151168035823caea5b7342e0533da7573b217d1a89711129a093bc84a9b1603406e621d59922d44d637c61a09a5d7da97b36c91fb3c6f0274678dcc04412417e9710cd6e6e7abdc1dc55bfcf1e8c698faf2d0387ea04721a950d735a0223797f22e99ca009fff91f28d87a1a0825698154cbd4c813d3bea0358978b5a199e0ee80c726720c6282dd3050d0670fe52569dc240df0a4d6c497e0afbcfa97a5a2b6919d44e4583d2d874c1b3b783b66952185be6953e2d0f326242b66f0b556ee83b59b8c66552310fe3922fa90f38f72f0f3e7d17e22dffc7549dfff52944896d16f10017d908a6c4dee30238158bda853f08426ff575ba89c991936a86760894f90e0e571b285534790cf31f489f5bf2009049d8f350fc311db75fee30ec2ef2762e8f3311deb732623bcfb351ca458ccfffc02c79dd90c13d8de58d7df85fc2364d0281763019e3e078439a9e495c765fd70b4981e7495e322c88b132073dfc25f5d7a557d9c24cbc7f57ff9183ce4a227e86504f988837804ea9771de87e51101e4cfbfb83cf124a4e6cd98de5929b1f2fac7aa7c9c43268e4dce7f79916d977436a2367f806617fe6d0e06ed1d8097498dab9a2d26e46ed972b266879564157dc1d50bb9e19974082a05f291eeb76f9a72c30cadf3d5578f229f17c65fb3714888746101ea357969c50c3f08e8ee8f5fb5bbc4a2a40d9f681bf396c6d3f1589740652d00b6d4f07b192427328dec1e7b3361f731bc5362cdcbf8347300f6ae8cf420f2694984be96edec6552c49472e24451096a06ce750445baf1e9326db642555e0d852b8758c11586663eec162a4f28d02e92eccbe29dc4b8635e754318d4004b06d2f1ace4b405b8175c4b66583b0de9781985d200e92da272a07f9e0ed0c51bdcb2086dac076b1685c484a49afa44979faef024dfca44a8a7d397508d0ba155bbfeef5ef9d196e88afc3cfdbccd1738d1c110be3066fb98b7a0169733ef9768d47370af504a7eb6d13c013ebe70a635e1cbc4d2d71ea607bf710be51406b7ecace79884815c5ae5b332f1227ff868fdf2c49f9647d2ae20154beb11b135cb6fc67438375bfe48954d224fc75784e61983c6408c3ade89cfc3f1a89b22f224026f5c011c8b0bca3fed370bb32d7e786dbb19658af17bad08e7c3d800de16d3f40b2df91ef5d86527cf2d9b97fdf83d235a264dafe8ea9d9d4187eba1182a95ab0368ac509d90d21336a8e01813c4f28da23e6f1f508bc3fb52ee919e024da57f4e7ffb857caccb652697745d01b290cf1991d0d05407c11dafe334445bdb2fb94f774aee5eb4546a954053f1cebcb0f1648c9c869af62b164c5807f0079b1051b5d451d5815aadaa08382e2d0b582a9f8d94af329298250e53b671c1f6295a5cdc5db60f5a2b081218bdddb4e11979eddcb73aaf28e15660e115750a97d495c1da6bb3c1d2ef11eb9474d86b55abc83a11d42401d25b275c4bdff953d4aadc96908518efa7a921f2df990fde1a850a94c9a67bf36e91b7e65c76fc20045b1d5858775d3423d9c4ea745931f4ae4eb211385d7f46fea34a99431fa9f60ce06e623a8e380ccbf60b339e55c5065bd18f394ed0ca2231cb4d58b2200bd3036486d90c0a6c7749e5503e4ab4050a452e812797c85f0849453f431aba4ae95b2a97e830859030e516e34eb649acf8cd964d42105fb00f3fd5e1d8391a635d05eda7b13dcab6cfa76f3dfef92442abf4a786062febff85866eb9d1a11e113eb8220cd53e8db42bea3dd80e95f3a2905c2e1d1e5f5f512068a21612e725e91c8140cd7d8f0a2e9492853b98f6c8205734b420a958654e54f6f33356bc4464132731a26cf3de222132fba40297ad7bb22f4c66284fe225bf6cdf4e7c62caa48d67fd2c51f76ef7869b9f0a92d649772d660c2bac0caa869526a8dbfbc4283e134201ce0624b29a0398a43063de2772c723ead28be478f77323394e9d991f3cc7292ee780d63b933bc46524c2c2af9dfd4ddb179e9ed6a39fca952c5d8c33ea8628a983940a79eb8bd849b4df723d3a6b9f88162fc2b7c28027d70e24f0ad13be446bd7fff4fc86d066a83b00a34fdb3dbe4cf50a49d1b0e105afa6b845150e4dfb0f94658b99bbabd798e4d16e70e5508cd8dd7db163e06edce854e2a136d482c63bd5710430208bb66d9eee164eb01efd30d4ccf77c007564ee6484327d860c4da03ca77bad1208dfc7876127f89ae046624a76ed84325ad3e731feb91c661b93f813a49ff1d8ebd02b246c52c68e8d965466496e8231992c3ece2a26d79a24d8adb133c9b162043decad63645f5ed81609eef8e5a9374c9a747e3a6cbc43761022cd159088aec8255475020e41e84c448c7a34e2aa6b933e845733c392ce62c89ba302ec5f3c4121e28755d31492c773c56509d7d65ad445d3eadd2242cd08e0d3cf96337b14ec78790fe32ea120ddbf76c1006489ba25d6410491d13c46cacc51eac5cb81302a318073cde730c350130c05a73e61661bdb31406fdb27c396beb2bf247d2d0deefd838c407cacf36dd471849202a3ae38abc6915a1d84fbf62b12e5873c0b52c920d1f1a3c0641047d6688a110222972312ea12a48a2faa4a4b7fe11f081a5f15996f0bd5698978b6c6e84f8b0d09588498cdcecc6a17b076e1d5caf67bd13010813a721539a8ff64b9fed5c8f8f807fde25ee9eea73217b0e0f33eb39d9f90b610113e6bca51d563cdc0f58a8081faa18c2252f126e7511f5e0f6a3dc41aff0b93a5075c1aa421a45ae7bbcf34019f394aa1d3839aa98aa62a9996d323e448929590db30b1b0c6dd5ca0788fd090d1b81ec7d6b4b18cd70a718c7cdc9029112e1092a35c907bef22f2a2f73e4bb782da40b6b673dd70ec3eff731218d744404494372bcf71f81fb6feb8d8af9c0958dd57a588ae75d41d71c466091037fe04c1491f6afcd74214d3483de8739cfda6224e787e8f3a9a706f1d153956d3fe2f3930f95a14f543270d23c049ff444e2ce1134676c07788b3da50381afbcd79ad82deb79b56bc71f8b310c1b73230784127b3893a1a8ac39cc800b54c711a8dfdde38a883c9804fc70889e7d24a5d0eea51c98a482b4c01780e03652a38e288a7eda7e2f7629e7f011c42043e1ab3521bb30a8902073a23b891edab61a897219bf72184eeb6f8a57dbbf6edff88b62d7769abca285b70927ddfb06e672c60bfe3f71667ec92978ee565fba636172c725f5c86ce701da6a35b34e0c954e6d24019c26e1b56728c98b012a784c730b306eb13095aaa375e4b78429d50215cb76372f4eb2bd78faaa19230b444b5399337878c5a2b904ab59caea8a4bf36f68a4a18100d91c16e6e7dfd53c5b3f00a94839aa70f5b3dcb3249dd1d078874961f32517b28da4107b188b97dca54820fa8a74549b36e19a0d03ef39a87d75a00fa809d354ab98a16dab64f43bef194c0df4f08c8fca4ccbd838f6adbae4952c68e7953dc632d6f28e4e202af6774a5d4cbdeff330bf9ac7a802c1409b257f6937d6b9763da430db040719c50e9445fb3b6f00042296773e002e78e284b1a80ce410705d1ab890c3cffd094c1f23005b34922c2b36d537c7732c070b96e0510b9d6e63db892c84a66438f316d3186fb3e7aa64c2d70aaaab4f40a3b2ca8d7f57c4ac59e13f468ed4752c2c6ce5f77e43b58ea470ddc2d5a9c6d9ee946a96d81cd10bf080ce399690c43741676e008b43a2a38a3ed237afed0b8ff1c01f29d321fd22be74f680b5f8df042d062780cab61dd6c29989470b90bd82dc4f718b54698e9023a83cadcbd9bce7894a79be43f4853f26240bd021abdd0b8312dc44c39a89915df8e1b910a20f9b28f8e4a4fee0d6c60635265d026d528a462f5387b700806c759be3666fc026db68683fc4df1e15ebb48a07229d72603b4466320d1e408840f84fba5516c51b987e6cb390a26e1647442e96ae5ca8bb9e00302f1cce4c912868dc5e2667dd53a4476efbb18a72d4498746ea900ea9705b3b88a754b6a62e8d275ab6a0ffcb217482c8a20ce1acbe7b52a35068caa97fe97fd69a57494230be4e15b6bb36ee1c615761df3942b52a886f272fe0e492f4669316e1c228f1839f2224061d7685edf933a3f97ce30ee4c9a0f4aab0e90dedab1783f296a45bae891255e9ef1f575f04ab85cb215e5135defce18bb6bcd783eadc80e930093c35dd2c57d58ac9042be657a067aa1600cf0b7f738bcd6b042f926720907d8e0280c6b84374801831320a1a4fb8e0d0766f5ff0daac25a3a6fa7d15e949a766cce78079e63376eed8e04d1ec301cf3e66326561547147b5c7850150d84d0864bf86c223a0a23e3e2138a4f523c94ec78ec824b4a47afe3ff1e73b3b37c2ac85bdafd114dfd1a64358924542d1717d84542b7e988b0f534608f8e5612e274ac7d6c8fcd8e6170bcdc0b840efca1e006ba3f5badf5d4cded5c911c6abfc8197bd8c0ca71fd3e27ee43e7f796ac8243e7534c30186cb48686a92b9dfcd833c5e62df9d89827b0f38c63afcd55252ef607e135e7e1f49c60a6679da1991573102c1d046441ca23f745090cbbabb818c94a71848a4e9233a0d0f22db26344ecaeb718ceeeb55b2c7f255b2b05ca088a13cc944e295c41acb0564f5f53a4216091259e9e68980e3d684098e34b2d968c32c3c740d40c05c2892db3e320b353315685586f6abfc27594b03999c7c7835413e8a700b0c66406618a14289fb7ff7aa6864251bd6124e46dfad2dc70f77161696b4b354528e6c702ef7f2e97df0443578e56d6ecb3d6c6a2bbda7e8193868528762d486078d22f7532cdd1f9c4c1a60c0b11fe736c705c5b05738140fff89163e3556ae79d77e98ec10af2ec688d856467abb82025849c4e611c9f9ce0a6af91578e4612e93c30652ef7c11dc15a833a7ef74334efdc9f5a3aa0562697d4471aa978753284118f35bd1ed545d828cba1590ab4e2764c89c8cd5fa3a28e79203bae199543a2bc94d4435783e6655769c0574eb46b7f724b14d735af2fdbda18e9b7c064e17e6f72e8f17e25ee960e16302243ca3b3291b42eab2b7edca10f3ac9472ef46322484f75cdc49bf65a3923f77551e70a8dfb4f0a523322c412e8b7637d1a1399b71ce2c5a405fe2f7fde6d39a4e1e8e47b4acce94311b8dcc7387adea2229dd032f069797c294b12c917b9f4d60d033e94ef9cc5fcc1d986ad59fe5460e4d92fa016a6279f8a1678d7a4633ca26ea254ac5d4bd557149545f11b950e62529063bba49f777b8d139687d45bd50dfe5ff442141cef822385712d5485e253763f6e34fc1f549a3091448210d736705098e0271641d8e5c8acc08a9d511dcf1b82213f5cc195ae1600de16a274a2d0febeb36785f98dccd993d82d124bfb0dc94cc09e4f88adf01c59d2b57e45f893d059a8e271d34978f12c9150684ce51146291841ce3fa9937b13ee5f3f4ca44f9f6c014bf66ed82619620900968fcded2507c4960fc8920d18d8cbcfd55ef2837371817319513cb377801d9ac98e187244462a38b775cf3f62658d098f09eadee84e1b0ba6abe8af296a28e6c865a70fabbeaae031c66d75a3069fa4c940681552aa5b0ec8ca0306f3d8dd44c3bdb511b54d44d2606a707519ddba1ee3ca33c7ac8b633e26b152bf724b631afe39e7f127002928048c9e28a7f3b1215a0c8a70a044dd68fdd1652b92b354b734d3143ccc986e77136a704a204c064d59d62e8566f7f5b8a8f0b1971c5239972ade884f3b9212a1945b4a8d80aa81c827c33111117e09a99c1a33b9688e6fda73530eaa4b7403534c1d39cb852d31fe78001fbae104d8939a00bd2208882ffbea121d6dce7f0ff6ceebc691eb20e124d241bdc"
        )
        val state1 = Serialization.decrypt(TestConstants.Bob.nodeParams.nodePrivateKey, waitForChannelReady, TestConstants.Bob.nodeParams)
        assertIs<WaitForChannelReady>(state1)
        assertEquals(state1.commitments.fundingTxId, fundingTx.txid)
        assertEquals(state1.commitments.channelFeatures, ChannelFeatures(setOf(Feature.StaticRemoteKey, Feature.AnchorOutputs)))
        val normal = Hex.decode(
            "5201c6067bf8049d3775ed7b2fa625a3001e454001cf2c7405ada1b2406054c2321db885caab31b65106b3474b71f29c4b0ce79c6d3941b37535ca6d835cb111d966f7f97f178b4541866aa170b901b0a0481b1bbe8907db33a62d4880e49e30a0e962d65233e4bfbca3b858208e7f133fe6dac59baa7233b005b3f9344cf0bc0a96a588e408743d4fd5422071afe8a2b1e7c96891cfa22a576edfef2aeee63eab3541ac5bbdfcdeb96515b019eeea576afd86d970971c5b5cb639258dddd4c55f2df0742519ccf5a87a521ab3779c3055d71e33ae011eecd127acbf72b9406917912baaaaa7ae7405b04f7b706365484265cad5c6f4f39492c0057a26baf6d57b97a0e37b9e095d02024012a7d140a63e678c02343ce0f974496b2567c79baea859064f863f2adb8f6fd2881974fb3ff9e49f240beb4c88e16fac29cd0aac958ecb3fe477e3345387bb1f45a95eebe9872f2d15d1de94c81c8924be678c66e2efa1cbf093eb221cbe346769fa4c6cf6afb821f0d9b85fc6b1e7183fc1760ab04344194cb52d2a78f17c495be96ddafd115244157719f4a518a5da8fc3c8b3017274c35f9ee9b3d76baaa1fb5df53a7b834deebcf6ff884be301218b7abbf4913ebb24876b0d3ae3a6c9cbed2e992d983711f5a6846519772456800dfb415641c4c6f375dea8546f0192e77c8bd96f70819c2d62ac5397949d8616792299ce982c3fea1fb7b488f8d4b45ab96ebd6d5213d919df6e96c17299bdbde8f98f123907a4c432f721410b2e6b81dd31364d1eedaf1091252b6f78caa2f70ba638ed1a642ee40956a685e4c7c69961b15c89bc2cbf00be157fc6e43a687dbac6f72e6478b9b2f86a470b6b6eb41a1804a3622f033d074e4f4dcaf9eebd38c80cde94890a85ee3cf085c88ee76724013c19abd1acbaa852add77dcd60d73e0ac31791e682b293deec964e4d6955ddd2d8f23486e0e6abbfa5f26985a8a033822f3d9b75a6bf0d3f2edb6dc2600897204ef126e159db6474498ab82cc30b01329def93dab482377d059f14e434fdcf5a41ea8a9c5a1f7511bfced99fa68deb03ebc497349a6d19a2412830165144df69a2589d91dad858760b88f7ae07c2ff504aab41a0d584ce0baecd7e79e9665f00c68d30417e4fb9ab93e6eeac0bde293111e024480425ec9e4604809f045138d27f13ebd39833afb145d7f2aeb2aeed26a0397f83da717bfcee36398e88e93844d7bc69db489d750cb505467d3c9402a9c1939f91dc092bb7e13da7fa6fafa31dd8914f04e78ac027eaf773bdeb0b1d13d72ccf7f37618e6ba81499e3b6ad39c5fa545a95c34af0716a51fe67ec77b957dce2695da87248a435e3f98f9fc7c60cfdcb427d1d5c984dae776982a1684c242135f4059c298a333650eb0eda48dc747792c24bba9d9a4b99f028c27f9c4038b721f85c73e6bb59a5d19dfce2bc164ce9f6e591413d4290e378aad1a12993863af5ed0e81d9f4ac841849058a5b3170107b3ddf209edd44d85df8bf7b8f4f8172e7a8641053f74f160b15cba123c7b563c5970babaa1295b9c628d72c6175b0c6073eef18a4ff7184990cd6b2b554bfd2d622e186e24d979c233eaef3820b0ca59ca8a476f83476571abe10a506840e214b2511ca9551a3888e9a1460e698929fbd2d9e8c84d375f81a6fd2f2c5b411ef2a96058884b46841f914856068484f9be9dad9f454b9f3ffadae55928e7efc89de9dbeaf3ec11e21ff753a8c5879b4c2fe8da8bbbd797defd8e6a4792066b79af12dcafec7f79019687542c8e8edc44de0f34c3527112d0ddb3995f3af2dff63afc193807f6c16a184bf15b43d8241213e31d6641af13481f7e7c285e338dbb52e6779e0917b5cfd1d2a33dea12c70bbff65a661dd18cd0e3c80cf7296d264a95e67a9fc372bc17afbdb66e57dd3d06cc6e287a7c002863610ac494bca70d5b7ade182dc3d5e2801da5e21a2203fd8c7aa8098c533c6927e2d304e0823ddb984cdbf2c4443ca7c2b5b93f7b127b5b8fd38a0cd7d215b6e75cb1376421767d8dc903713e674fc5d6f602802c79982cc3f009ebda3c08af0cd5dc0bab5e99abfa1c09a1cd218a6b93f5a9944feafd500516b956bb57cac2636fde6924343728cc57de0d8669e2db390c1385c789284f38fe2446388a9eb3bb28f612458882ae706c09718c97892d4103cdd0ca960439b10197dbfd1eb37c6a6ef9575a07e8ae0f56a9af7e2d9b6500565ae20d1579288a320f06d5df94971193d04f0b873c5ac73800b1eab28b47174b3da055411844ffc880961c5b164d62fddb22a823a5eb757d49f8bafa387c23f84a94b3236fc5f279e90a0338132b93a53a6d79ad2e3422491ffd915b39ef7aa8a1400baa8a07d5b61b3f6603570c0a7a68612f2d6da0ccf10d00762a83f4d4f3095f7501b5ead910fd7f58ee784e5a578b1aaf7804afc64b0694a256b2f41f30060886ded8b76afaa9d69ed1fb126e30442cb99aea0f05eff289944cee86a0bbbe4342a1d7b45e0b337ca2d2beb798bbfb589054ed3e484938975bea1e410d3e1d22c9b3cd7353c47528b37c25f972bc1d352200ad613f1b78e37514718c5f848060118762011ba00265feb0a5fe51c20bc0359c303c4f5a88534ba182b65253535e0d596b69f291effb0eb9d4e4e737cdb4a0ab52d4af5a062012fd7a2f1a0a1b7e6ccbede8799b00f2e6f7224c8aa79702f5c0753867408e53e6c76a43572ab6488e433316b3506f6895c094a8939ba4b33ff6b430f330fb8e4f776fccdebebd6526112b494fe11befc73865be16f7774657804729916bad6eb20d227d824d5c1e4402bd5bdbc252b309f9a53d84fb7b33a7c3d9ec4db157fecb636a5928f06bbf305af9aac6173b7aa984cb754d8f41775569e12338daa75c8e8597fd7fb22b6222a29f9d029e2faf08671aa42c60b7139dab34249c363d3db734fbf51993f65dc69e98b1dada81502ff71127a9de87a7ebf0a07ee27e9313930e4135cc0de06cb03ecdf09ae39969885a83f614c8ba541a4078559b831c9f5f00cee9e925a292c402961a0e9319a5df78911370ee3343f460e21686bbe22cd68336b3592e6bd5b4f3a53cd44f4034685f425f61624fe67e0ebb5d8c7ff593b9b875c60f92bd12c328e297cf388ba7356c78ac8e626da744b7f3dcd3295d9be08fcc9b9c2566b5f8163332142656c6d447b20cb6d35731300e92dfe04e73d7cf00e7365a3682b8564c23bac4ac53ae59d8ff2c5c22b701568b99d24c9a26fc767e01997cdd7d97b80d9be6804140f6eb801be58de58d669a81af48d687a6661146a0e4e6484e0cabd0dc0561327e47183a280f545a472adf10cdf6a8dc5bbeebd6ea8fc806ec6e1bf97a9362e0814971cba0fa35e9d8fee9a969c12a0b9cc2464cc022cb1de827625458ffea9fc21fe5ee0ca4a9b27f90f13e1518b5d856925174861e55049c78fdd20e944aaf29518b1b237aacbab56ee918ca536e3c646480dd13ca8a7c4038003967d2547c62c4374ace222291026b42fb3e23e62e33c51a409ad81b170f49ebe8c2c76fb87dfed69530e22ebc29939209ed7bc6ae5b41287c7717d91b8f84315c185418d712d38a33f4c6a9b1a13c3303a234f4e58f92f0e3cc9371da356f30d40e4495cdb3c1750ce1b45a9e77e6d5da406b5ca43e25092a0660ba469383d216458ffd57ecbf94701f29163cd9d47d1dd8ee7b9df713637206e466a0f432b348545f4b8b7282576badf701e5e52e006beabacbd041d204280c32f4bbe5ef9fbaa5b58fa6c84d04551255f2911ebf59d26d99fb2df16fa12675e67ab49bf0e8b1efc91c8a39ba75df3383292a888fa1cf6a0452daf344a214ee2f136841039a936cbd327446b1a18ba1b40c73896dbe188af0c0612d1ae1d8a6411f8d849f2f289fb7bbbe72a6031e27c17ea35bbff330e027e526f107d6d346c8e7fc9c67654cb6103b595ada078b62f95a6bdd4aa5b639c4e3838ee9b6828ab07cebb8cb08bc72d5f033d41b882617fae723318b8658a9c4ac55dc61629ef108308d94c7d3e66e0b834015188d5d0a9680ce2b7c3b6804e8f38228798d21f432e0f882c1d54a55f48785bd3a69a7212524bbad7caed94f7dcc8a85c840f5e668a3292c94470f30b42270d63812011a262123653e19724036227b5f443a225536b36f809f17ea05c930b5feb37d310b09b212fbe81ceba34a9a1465d00c960233ba39d4fe252a866a3273dae058abc31a03349daf95f65c85997be90abd810e1bff79458fedaf559c6cc3fb3d581829f482a7dfa416731fc9e4e68be2c0dd07d57fdfdd416e7631377b2005646366c920aed03d49933b1540c1126435d6af0fedfb5f4acb309ea06188d87241f5d94ac80ca867965ec53f28165fa6aecee025df2e34f7b98ac91880cbc5f8fecb537689850a8d8a6ae793135173d1dd79848c558b46efc5a53f2cd1bae463a5527358785fbbae611940301ebb176f24f5f6d9c314e302db818ae42378ebdb16b0ac230418bf9fb5aef7f256eead878e64ad5878b3b9854d9e60cb95880bfea3524c8e0faab6d1fe7a29b6ef8ba89cbf612e04a94db318d0ce919fca22278f497aa4cc57e8e24908ff304a4cd4d9fa9d986c06b822143ef0569466098df46ee67e5b281266bcf54777b96c901c75fb852c9af43a036b4e870f46026975c0c6c57b2067f11e056a7f394023d9db8ca576d5adce18b6d9bd6f76954a85cdcd3539199f484a8d6de8ba18057cfa1361fef753ecd89a9e602816e57ffbc7689c1a0c99bf41ba6cc484b7835785684ab3312d1691f4bb6c0abb3b0c1a96064e1769621acfdffac65f5b11adfc1235c22aa309f72e6f8a80ae42a72d981b03dced5c93523d50c7c65ba6779a442612eb35acd1ee4dd35b262fee7db1798479a7e7836087377c0c1ebf86a52f2c45e5edc9f6ed3a84b6d98dd1f2a9c6862c552d836dbbe83de4472c4ab1c69e695dcb9ecc26ec4496f3454bbff307618796527e17588e433dfe0dfca05d6ba3656649031be214454f706e9f240d5754823da07502c7ad9648a7db9390bf3ec76160ff8653a77667beb6e9836f843d74113aa3963a598d8b9061971cdde62a9da62f1354db4dc7078dca1a3e4212ded36ce7406a72b523b2576358e69d7576d5e8f52474ec9461a589230070393f771a52ca221c97beb28729c4482b32feca45934914751820cf8d6fa7549ee3e60d8fa695563022f47062fc7af363078d4a576"
        )
        val state2 = Serialization.decrypt(TestConstants.Bob.nodeParams.nodePrivateKey, normal, TestConstants.Bob.nodeParams)
        assertIs<Normal>(state2)
        assertEquals(state2.commitments.fundingTxId, fundingTx.txid)
        assertEquals(state2.commitments.channelFeatures, ChannelFeatures(setOf(Feature.StaticRemoteKey, Feature.AnchorOutputs)))
        val normalWithHtlcs = Hex.decode(
            "da74cec5a7f4e270c0b4545e499b5739020b2aa19f2fea13b8ec5f514c3becc8219fec5364e03688152135d43a8c11d1b63727e636258d9fc204ed72f86485fde2c5b65100570d985007478c9a28ad7282db71d9874c7d7d6bb495e2b8485e3ad3e5fbc33aee171444e429ee37bf77089e25b215d8d04c91c6b7170f40b715f1b47074356e37119c3c00b93607d1b8f7ef7e702ec44bc5b57e2bb1791c75ec44a1d283756f21e2a6b07bf1232a88ee1e23b7986671877842f7b1575c1b00b4b0e3cec59f5e4298b06d5e4749e222a8fbbd7aeee93dae3f9863ac81e0133aa6353299b5eb56cfb5d4a33e8fbe1fee49e562c7bef133e03a24f25540d25ad5ed9eb0be5f9cddc1a26bd98ef11f03bd2f1fc99f9d6d0adacb2708271369cbac2149b323038bd9fcc488e162e290e99dbaea558cbf213f53e3179d9b48397a322125f3fc0b3209ef6e8ba91caa8a9c1f5f648090b24d4f1eda7c366630c77f041de9a66a9e339a51f9658b841ec9fc8e031b5ef547a8506f93d42c20f8ab2d1a5145e489d535250fc33f9ec4215a036addc0a03bf202a65c87a829d70cca5ee2e9e25f80f7faa9cd904b8324700c8a5fd98c6c087812425163402ec510da193bbbf6c6f1a8c60d24844fd684c8981c55af209308638b95880c2a12e02a7a52186c55ec71b3a17e4355c686cee01db0630068451fcfe546dfb0aa555d9c1e6321277f068577a695b5dbd0764c8b11267925a0e090fa2d1c922f361e132e124b22eff559ce68e2fe3c6d9a52bb4231761e233bddb6456a42ea18547efcf9d7125f38d6c296242f11801d746f503d97782b1c12b7fc225d95e6a9d7ebf59d3242a40331973d9ec49517e2530d99d2786e2785a98753bee23f38991d85d196eea56c93a9df65d387b10ab5c673ea2d5e54057ffe8e83d83f974f41a8c595c1418e6d862acf8cf2e7fe00b2ea17edc2b6e9c60dc8585bfd8dd1385c2dd52a50483f4ef5a6aa096a7591e25f8c7927823ed7a367f46b67df9fdbfb3e2ccfb80b9aa7e2f5e282e87be641ebb633bc7f3ffed1a2e8e568879aca0c8e39dec52ca5452901c12b88a63104afd2fe9d1a07869bd868f6074a778eab042b8d8df24367c0e577c88a94e496f9ce1f018d55d13866be471a504aabb45277f453bb4044faef8f5c70bbb782c1e93ec2f6d49e9ee09e71442a68685bcb21cad166ba6131971b0460bddc8f196186872ff57a21a48995688a95b0c75025d490837f638718e240c38233bfff6e50d660633da0cc15345650bbb4e3a9cddac50284de7383fa05143d060fc98d95b8380f277d84413dd402b3fd336ee452cd37913073e0707325247266a1e06ae3c68ab3bbd41ce46cdafbd53e1972f9c220ef55e9e9a50d648d1f9e3e4512c5b008da72e91d87a11b9e6a3f73f485c07ccf1dd224b54fe1b309ae6979145dac7d952b2e3648dcbff2e996f86eee7899f9e6d214117eca77cce14a58f31a3f3a981a7ffc615bf6964332c897242ea62ad0a2f1ec77a2eeb1f975856cbfc6f820ab0eb0ac2d76fea31eedd1c6d87a1b136f091d1366a3544e4454eb0a0fb02a8538fde614d3d119ab207d095c77a61a7cd8aa8adfc12dade0c0784f0a1563436b95e68f11da64c404445b1abb58957c49f3d56e1a3ad46052062ddb1a216a5f5bb31df8f114afb594ad4a4bdf926283ed87c32b3b10b1ec46471cca157d6e4082007bf92e37b5125d2f3817628b983b43edf992f59f8594800c4c9f4482710400b2e7309ab59a67bd5db4b6b5aab4c061f52a79ddd393e542f2e9e635ac38a284d498797fa7029ec184740257d6e986742a0cd03bd0246ea98d38f7b8134a9e8b4cce693a09a0270fcb97ea7954b23072fe7b7920ef4aba02ce1f0556914459db66003665881e92357b339bb0b90af5364227988e62a47da1150fa3194eab76754eb292cca044c6cdcb71f50333f7690ce58a13edaea7c0ff545b09f4b051686fa27bdbe7db9964b1892dc2b96e04d8d18f67e75d4a34db945982fef4346d5087b5ae2146ffcdd0fdd68b137787a6d45962f4077b88c0922d0892726cf1f4b6db036debd92e864bda639e46054de3c2b291a8a940e986128fd78ab6bc545ef5ebb46233cb8e546d098451660afeae7707e1f79c1bda88035fdfdc202bccecc5c8be19528f24dcbf1fc9afeb8a0a7bd748dcb34ffbd2bc3aafb64b864ea75dbfc14705a55d6ab30947911cc214046519ec4ee7480a93d24c7080a1b1b663e89d4cd92cfd6bed19ea221c8fc0f097dbc5c2ae781788e806fbb52121d87e064f0902bb4f3c3baedd613e456d4df3f3f681a2bf3923cf51fefcd688083e0d1fd1a0d4a8a092cd414ffd97131c691c6df23f28145cebd823bae7cdfe47cef63ceb45dc0a50d8307da9b92ac3c197716223c0bbbfcbf278cc3090b8b7bee3dcd4d4deb2c57da51e5b2c815819de006fda656d47113abc1d5904511bb7d71d776008b71e9dc947c58affbeeadf8eeaadb74d74b22a68c4f9a5a68356cdf988f8ab951708ac7d1373bedae4cc2fcd6a0605b7452025207c4e96fae4b1fc658539fffcb080880d10a812d806cf18b6ed4c707faed7a8408d4a2e5a49e9c510362c24a1d68012268ab33c9204493443deb7cbcf696047d08cf7071a9d46c752ebace6ba44dec0fb3435e595123cfcc2eba00b3bf2ef18a3dea4ad819734659846ad6bf31379557a4a964fcd0edcd98b97c31b9c730567bc3c642d20b67a1acbeffa50008a2ad1e4ffaaabd983f6eff8e6d7f97599e0f4331d7afa137f2e75fefa793faf8789e052761439a552d506df06af61324afbcd50c36f1012a2fb72cfe1d763bf755bf1ba9a54ec0029a4666de1d288bfb6aa7e936563a90b84c702823f319f63139d2f3479301cd32398ecb0f06371beea8c8e60577aad268edc8c81aab168094ce9eab05317a011d08ff74f553837962fd66cd5ed650c7beb6515bc0677fe4927491f81d4eafa26b956797403ce9c32513cad27cfc7d15582df49f02334e1c94b7875f0f3af79cb6b5802a1b6399db7941fa48ea8404f526cbe8cc3b5e11fdd3acafabc26a1bbfe5f515f1d67fc00c3aa8bbcda730be81a0d63ee1d68acbf2bc769fcf8a3f8b4442a3e9be65e21923db834afbda5db304c49202f5f8f0854a9cf10061855ed05eea07a05c63e28d4dc8971d88b500cbfee0abde0e9cb9e1e77be00e34afca7ce2400fabc4383891e152951ab12847f0f7cc3e68d2e960cfbd1f403967d022f941babf896fe24ca4f502e536914836152e8dd13eb097a8a9e9bc6aa6cd608c2afce343ad51b87e5a09b76ac45d1286bafad65b8d329127bee75e08edbad5c0e40e24c4c7efac1c46cfe785b87836019166f5c4ec285c616e1364b6d883046820296b0d40ac66fea62f900523209117d0fe99fb75396dc18e15351ac7511158dd05ee6c7ab11e032c71dd1d0f7d738224ba69e85cc2cb654a9a64579feb3ecfe1fecaa8509d724b5978cd09c4614317d5dcf99d6a385a1ce47508f92457ba92ef338743e3f86c3bab94219bcd9231aacb4417e81cfee34e137fba76e07d60858ff014150c96d1ec64698becd40abf68513e53cd782f273158d8b14b7e6953d53c661cbbbcef63aaa7bd7fb07001572ea95d8959fc63409d9540fd52e98e65f5f26d3b40f43e4ed40b6e56ff8733483e3cfe3e833b455ae80a63a1d2a89841942cd6291b47e41aee4ddfcacd5dba799b353bd16c3cc29679d21f37b48aec01ac03d47b90b8fd3d3710662fdec61f576b1f067fbd56452423b933fa011304b49d3fead753efa06fa9bd83c0905a0b73f6566d04ea49695f79ba721087f726e70e0ec4af2171da2542686501757e4308ccb58ef309340c75c1ca134fcda0d10107304f2dbf635f77b9ca6e2cf1ade4234acc5ad0bca110a95fd25a6464cdabc70827711677608c5b146b93ff3d8518a692ff07781f4c03673aee538b8490524fa9205fcc761d28e61b31215feb1e55714adc63133fd22f6f81e6db424a3f1017675059b2b73aa04a9f29bd80a1ac3b7c69a2fe7a7a4204c465c162e57c578e883033a2e6c2afd382d1da32c050be7e5552c7582efa3ffa89ed11b84ce9f0ef4c846b91c41757f1e6eca905be136a2ad7a8aef9f14c217fce4c171c357b8f6c8f868df471060e1b84cac7a7b8378322526fc07ad48cafe4751d8ebad642b7781eb44f68edffd01909874e0074dedbb74904a2b5bfca59ed3fde57aeef31178d356c4e86f093bf7f40db523af7e619405dae023f79a299d63061517eb55725abacc76e2c712d30b8bbb9dc5a705c77b789a6d2190989437d6a072f4df49ad3cea638dabf0c481aaec721e88ca2eed49cf129883c165723665eac513da42b5c02372d97b1627def95a2a2973f526140f06aaada9743ce526b04fc33c25d9aa238afac784d4962f1b925a524f17a2b9b312803969d99ebadf5206966373fd686b66bba60c30b1d07cbd835981a85492194f541dbbdc2b48461f59539d97c3aa970c55deb464fd99408f3dc4ac8a9944dd73f2455e77de3c3302bce56c7e26342799b3258af26b3c387ec1661c828b178fa510b704b6f273ef9a552a0d7d7aed332146090e8894f7c35d7825a82c5a43bcb0003f6d640a21f7e88478ef8e6b2f781968ca46a1790de9099deb7ceb14c484afc24aa39c222af82772243625673df09344bf37978852b40705570c451a0b9149995557c30b0532ac03996aa8f3bc64e019f07266b8a83611c5b798b365c6e072338c84951937e2bdf809216cb85b5a2f473728d7db2062edf6f33b72ba4fa4205c7f94908337dfe58661d887102bd6ad7e4c23c7b6733e2bc787bc651c3914fc42d8b4dbd5aa449c6cebcdf64dff6f91ee80cd26c8b24cb8ac29a0ac5dc00dcc80be2a9756983e4bf258eb31d241e8918501a2cda7fd63ca25f02428c2aa3741e714c84ed6e78e56a1254321dc423183fc3816abf60bb79744f196f19c7a8e18666bc659595dbaecc32a3cb07846d9af5330dbd6b18dbc47ffe347048befd00cfcba3af0e70d5254229537cec10db06a952d35060268dca85cd6238a62f1b3bf60527b5e7a827c91f8a530a08f170576d00d287f5396e84c47b406046236a27a69fd7e31dce0eb9dccc428b5d93d7c66bc42efd2f9d7b9eac103d0e06b4453d904f06b895900d97b4aba97bf11d0479ea43d41e606f1c2500ebd9cef3f901ce94e3b9cbf7a9a24c1ae9674a767d34f91da60b098531d563ee910fc4982b633efd3f8f3a55b75abed224fa74251e6270086ae28a5b6e1298f60164c8c1d19a17c9d380aa8021b3d2ee447175fe6b57806bcb7f28ac8bda8b8d4f57ce5d26982411cd4ad7ead68d0061d008339d3d2674a6328ce32d63a0fe6f8918eb02b3bad88dfc744e13825c79c5286f02216770cd0999be0067088abd4dee412b022c57be55d803d24c6398d055ad05089cbe39e09aaf3ec07dd1725ae7014d0d3807319ffd4e94ffd4aa98d0c2a1de3450b1eb15a6246085446efe0b690257dc9dad43d771e6e04dae9bf5218f2d4e4f5b2f871b4f6b22632d3aa92f7bde5eafd8e1243c103a83bbd8e00cfeaefba0be9e0381a5dd0dd5b22ae0f5d204e7f2fd5ad1966b8dd9a214c0ce816ec6d86c1b06547097420e421d808259eccec53c6da7c80af43552145c68fad0dfc3342fd40dab72d0e55d0236b2ddba0a043641ff2706dc68a2b016034543a353374f5784c53bd3017415b22cd4c1e517315a0a0b4a385206ffee35ffc35b4f9a2863c99d475b96a946287700a8cbe3ac5d47d6126eaa547439560d5870eb9e20fd582eca189fe95f2d14da887533e4157bb3973eaf7ea2ce0c7a16ba2e6ed7bd972c14fea1604a5fd02aae39a48d331852f0db8fd22883043df4aaeb7e8900f68fd88b16bc51acd699c0d431cf4b077b2e27428b303b686ccb9c1e4a640226f0bea4f5c5abed15bcf99bfb812dd7608c473dcb49ccbfa96d8ba409771e6cd5147d50c59b1a149820371b8ee6a646aa6d50b1e53c4a8d51d8adaa5b54ebb3bcf2e748ba817164c358dd08a259359a40d3b8a602664e0ca99c924a2b357358e8b6790cd7b9ce7c566d117ba66dcf33c25239b02d7e7cf63591e755e2e6a553acc782c447cd6db0f8748a0049d4b6eaf818d14c8c8be78ef4a03c897c9ce849f3054b3710eb1a470793e8b0f37f60c16cce00fc4c61ccaf42eca11d5d855abcf6a20618f232e2621d2ad38596708bfcd9b0fef972d2defe43d601466d2a3f4a10f451572f0eda325cbbfb45a45c99a12e94d86458399b2ece094564a9e6de5e0803b713bf07713dfc4f07908bfa56cd4cc11133dfdfc397a85d6962e93dfc7b338a13bf48ecc906f4176ecd852005be88a843dccc6f48547382a2daaff1210e3475ea867126cc8ee5c53122ab2eeae82e7944a7c99b0d830f7010e2b6852aa6152c7fd4eb466e2200acac288ac7cab42d423e3be9c7e6bcc2509c9bd3f8bdb43c23e2e6e0e88b460bb99edd95a1d99d57152003332b149d34ae99d3c3840afd5c942a3fd2b97b0198e84de1d4e75f6a699c52b6502f3d2930c6fb15661853bd92ab580d2d534b036e0dc23b879e64a705a97b72d74323f000ce40f88460d7055d9de15e2f7a257705c233f9c9ab9272c73ab32480a3eb835b0c662771a06eff7f1f2a0a28cd65243ec24a04bbdce42a9b79d80a58ba1dcde493ce19b44fe90787a4a651f9a279f94886ff8805687dfd5bb1bc95db33c8355ede0b0d77c83ca1793efaf0da3f16d4647293ebbc1740cbb6ca59f846be89c7fc5e521818952093000129a89ab84bda9f61c733d655780c2f4eb95977f5260ac7231e184c989b64c51de3af98e5023c72ce8e6fbdce97a10996cd5fdb4cdb4f7caf25c8f26b57f7d0302ffd85e61e9caa831821ade2eff3aaf2cd8f4d7e0f5e9cb022eab6162f766e134f6091a3c811c0b871f9f2b7fce692d59466f854775e863970e1d1353be745c0940eede25ecab6e51e950159ac1157c8ed8f778e1dbb0df72d2af13f47157dbe64d2979639ae7511c51bdb89cb03c4b4d45671edff1a92a88a915eed954137ca2a046c44fc4d3c45fb0e76a481a508da3f82dd4553a17e7ca3d1e4122885fb344b58d8c1470fbce5420cf0241459e429a1ef3ad49fb5b5294b4a62747a97796ec778daf2c7bbcdde1ee1573cf3e6886194790d1d1bdd8a369d0900e51ffd21b0c3ab2f20f96aa3d7599ce2d6ff3bf19b136ade5f3c01021c26c77c0a158f7859b053c9f8238af7b09668757c40c4874e24df4abb111b1bf8ad26eac888b2626a2ea809fe465bca4141d21956bed7deee7b230f6daa5090961a9f9031722808fd8be0493a48fac39d6aee910488cb28d0e5c78b41297b04351d29d7e4df98251550bb9ef11b4780b1ed5b61cdd0b7d987a06b0e5283e56cff2a2c37b3b12dc1af669234560d19f231d687f73ddf77442dec73efc1476ce8b57f081c34414dbb10b9c3fdba086ef8f76bcfd86993fc52dd76b4a59e6f43dac4b795498a75769f3ff4dcc1f652698526812ecd40b5210540cebf731ee4a11693be7d4f4f58faaed7f81efa33643c8a7b7fd4f70644056d42c737eafb2e1d85dca2b906b133e5292aab0ecb861cae1f9006749e43dbd4d1757b39c6be07c4413868217c8d1b24a07baa9e109fd2e5bc0a2229f09e946d47005d7a952c6cc5bdebada5f4cb8e333dac3a0b251b563ae6150a3267872cdbf29563cc685f9e84894f5aa4ffa72ca2fa756708736f7b745adb5a8e5c8c157a19828835d3df93443c50c467b337b9567e38e82a6708c2a7c9366c5d03a72b11fec6ce44146a483ae30f9cae0c2c6b97bf4d183aa67b178f68abae686cb188ef0220c26d4555a88278fc2fb50eed7e671dd1d4a02ace661792f3b1e7301a9e9b21da1289eedd539b69df2501eebe8c8fff03eba2a5361ad031ce3b9531dae890fa54c80b330506ebfbb2940bd670c7ea51cfcbab962db17d6d9b272443d5955a8500c2991af31fed3799ef250bdbfb52f444b7a8176f8d9e4f39ff4c6f14fbaff3a0d31512c138feb6f1b1e580714d20d78ad0f6bb0c4d90711eb1b070b2555d1f85d02a5c0c9564b702066aebb4cc49f6cbaa33a6fa09a794c79181bed96f64e566e5e89c369c9fd71bbe74872416f4bb07e32dd10e7a7f13411d2c329b9a3902dc4820fafe189b00da8377bb166f41707e317ac16ce95fccf80f05b2c3dd0aecaa7d5237c4942a8fbb05623e583837c4f2df54e03c5e274c86fabf5e5cdb01f64e2e74f6a5e3e904e03ba8130fb6050468fe4432186a48207c2a8c69573173af4fcf1200b98dc911a95ef2eed88492fbc36d3bad678ce8a82ce3f7e36a0412497e085141f7285fbd991863c75100da4c902a3f004582e5b21e7cc8618c2fc18cc8ccc0cb58dccb2e8e6be645c2f938b152f25526473140d19beb40f6b06c880bd71e1135ea7f7019fcbd97f267f832b1a07f2a736f5e887f06cf83e7f5dcb3234129fef327ca9bd9f2194a4a1d5fdd5e9d6c00d16b11c642927c03058a06ab8b247297691acfec041e88dd7ee14fb595eea782137755bb67937f70c09d80da520add43790f04d665aa57d47e2a7d0d0237855e4aeec96e728b54b9cf80209e551430680d2c3ff25f21059501459e5fa1434d492e93bb8f00f02013b721ac3d78b819801fd3340c9c3e644222065f85a998769199d457f01cc647ee9d063b6584d0ae287300de58d94772af09f8d81b94f15d9dfb47184854bb43d41044b4e1c4fdf6fe41290bb1a60765810582b68e579082413c0fcb37855df984380e113ba88c2d1f558eabd2a10ca0491461357d3f83436c2bcd5449cec6b100b1b6cd79c971c6f48acafe29a346187c910750fccb622808743ee840a479675f3cde18e5ee2571564563371eb5e05984d791a8166c8fa577cde7e2823e56b447969b514e85c78d2a1a3279de4a7b4aa0a3d8eff5f3f01db67dcdcc7a2a7af448313ae4cacb8f775b79038b67d48e99fc202c28cc7bc311d28116143ce89d4a284bcfbc10362b71db638fb5210b2d67a4e08b35f4023cd9877c75732c64075d1d4ba4dce0d41647a284d7b4e5445ee5cbf11953383946b84b56c6cf0e95d3a0fa6cb931c09a63de356b24208f97dd1a550f47effb17fb29c9bbb3f46cef5cd545dc019f4cc9418463a6836a0199ecaef089dcad7a1bf1ca07dd49309db08ae57aa1dd328dd63d4b67303819cce99fe11e5dcb3b3645c3c892f2e84b0f93839484de56050b31e2fee69cfae308d379cbef27b0a444e052cc6e04103932693ee3f0411e3ed0960dfc16cf45cd264b8b5f2f4db8ddfbf15842634945993e170384b0afad06129e4f8bd66afe54064310f371834e1f14e2314bfadf3da865c3bb77de9fbcfb5b3575e2fe2c3900519de3990a9cb7466c2a3394e0c9d49ac939ae61217e0576af2102c2c6a38fc5a9e1b9257b3ee192b81baa1cdf7005ad00e8c7e3c5bef7a4be0d8f54f0e042dc178bfbb4227f72431a9903e778b8232d6a73b10f0158ad967bd1d896090a633f6e18d8a1126fe5ab15c36e93a7f9dbf13b197fb3e9a95d7dc7a2e7b982e299fa0e609f7c41d59551bc3272ea3f984a37d50169bb3e05ed3ef63bdf1c8086d5ae097c9100169f9a226f9735e7818c875bc4c712d4ade13079e653e09636109f74466968d14107de4fb6f8569e90afa3aa479e4a6972479dbaf1277534a1302da8dd45d6ed4ce48b085ce0b50ef0c0090693eb127e43a2e0f4d641b6e0e4ead155dc60b050f1065cd22ff96d97b9eaa834bc5d4500bd1b43f9168e4d49aff37cd1e8195c3cca936a8b281d509b128f1eedb8bcf251d29c475cfe3e6a53afda61cb1bd264fc5fb55385702d91f63b1f8834cbced59d6dc2744a2314b7c426f285c9d7376ee51dbfc1b3aac68e80ec633594426106779c23bbc52f6d5c0fac7b7293fb475402046fd590dfa796085a8986f3c55d4b6040a45ac31a8c2b3d5d2097f80576dd852b4220360830a04b1e0eb8ef3711389b77eba8753f2d2b94caca75710946585107a1c087e44ed054d1bf528515b32f16bd8e8286936e376b963158e710694ad3874a839df75337d6268f8f9f5a303d599a29bb72b28678ba8f739eae1480e7db41737d38303cacabe53d86c4568d0e0450c45bcff15807c032c1087ec3e38dc76e19913c99d1ed6daa44d9fdb6935516c00111450b948de276d98766e4382b7256fcbeac44ce5bc0d8360742499eeb353cc7c03919081536c6d9a37e5e2a1fd5776705bac59db0bb138ef21c8e50afc6f48930b8d66c9b7ea5d35deab95815677f4093f35aed5c831dca3165fbd46322349e48c807aa8ce09cdd08edf60705cc859ae88e2bbe2a160bc2961039d9f3fc98adc695a75a3664a57d4f3c18428c343f02fa952e4bba47633a4ca328c8195183d79a114ae65bdfb469a6ea7b76eb1293a59952504731d4f79175bc42804428e315d5b7b5cb8aaa884784d01b30c49e3f6ed58b6b8282d261ffd45889b4831cf669b3fde99c586e21b401dfa4e08f5cf41976b7f5ac5ddd0f71bf632dafd8972b7ddf63c15fc1625b39241dda2f2695e403cd2f099508a654e6ba541a31ab69a3f5c312ea3dbbbbd8a7f83b1cb4622c7c0ccd125621c0a8b7ea3995be86147ef86de24dc94a616cc2af1bdaec9adc39ba99fab454df07260fe2df8fe46f027813ce73144afaf96771ecadbc6e189a1bec5754a1be7702814e09e2e43523eefeb6368ddf14bd7cd6e5d65e4dfc0fd5ddb9b1a8cbf76436f9153107234452a6e5319f5c13dc2748271ccedfb4ea082b7c6fcef33337aea9f5cf8a2346e251b895abaf0dad270a1ce06b56bd52269833331869687960b5ce08ee939249d158543131eda2c50e1110e41bd10801690d08a4c493d23b4b4a9dad1c35818a9cf6b7d76be32dbdf3a55c3640c2163e407366968da5dbe8161ceb4fda2fdcdbde77ba89822278b0a8f4d686402297fb8ec3ec3656e88e72db16beed169f4abc4b5eeb871361d43fc3806c057f81cf838d42b164f371098e7a3c84ecb96c52535c54cae782085128f7450b09c976e93fe951bc8f697343c7a32da6b4a880f0f39cc4524b81d2a716a95939eae9eb6d005744a9e92192566ea11ad70ae7a38d4e749a2f6cde9e73f68d043762a79f1f08641837271c3bb5d1227b39aca03e0ce1cfe1429e3367fc61ce7b37d1d750dceb878fa5a63b0a003cd3e706362d491de253ed6835750a0856d63829f50c25de15c634e6675dd9f6d631b827147bfe77b8f7e8b6ab8629e3d6cce83b4e54e7cc7434240a7f5f403a3ce5555213e39cc9bb035a0871a381d6419621c4758b9d750fe1a7956efe010bf10f2611c067acb8da891e54d7cbb34c31973d8b74ba0f977c87fc09a10443a1d4199025c6feaa751b56fe59798a00ff2b80ebdfd663d274af4f97b65393c21f7e4f3eabb77ebae06a7c927705a4f15785af84778582422aec94ce59a80f390c0bf104db5a9a2edfde62445ad3652ad6e661b2388ee1fec962004f83684a79bec41de6b7267d4b8ac8b15338987871ee16431a9220de289f953408712b635db7da7034ffdfc9230d3caff96cb8c504a37faa553afa2a791af5dba27b5b32ecb075968f22e41abdbdec826c13f15145c3d8db4ac5c8fa2e58439b3db58fad731ccc715b607d50718b7e199f7360dcee2ccf90d3f62824b7e6e57524404609b53611e834c319292aef6578b775ff34ae14d9d938341746062072a69c07dc7cc3824923fbbe6a4897e1e05d3271292eb7e93dcb36080b16b8a41e58108783787d4af516bac75aed2d9f408841ff5e3e249467da3086583d6afb5bb6413afb30c894001d8c26a5c9e6df390892cfc9d83788a95d6ba06603523aab5bbb749ec47f934c5adb00d420528f189f507e3d0e8da5c7737a498e39c6412261186598ab9ab15717205aae245e725b853ec258788ea4c22e60b008a5a5f8388b7cf44aa3c196963838f82bc0bdd81da3a7ee9077f4533da2d1d359aca9da0bf4307cfe3d39d71cc8ea0c964a27ad7edb8e4f4142874c5931f7ec27710424f4463c268c6e5bf2734bb8882c5deed428ecadd3a75f62aa33018d3c2134639114426c3ddee02758d420317b39a6860b9bc13804d78eba3fa87ece51e998cedfb5cc9ea0fa96a46d13a1fe7eab2e2716c5a8f2a6f7856c72bd902b799aad05e255d6de9265da76bab1d2756d21a28791cc52ceab4d0ca620c99fa5f9cfeb3b296b03bac9a79f3449d6aa6b2506a9be43a052edea31e367fd6a5fed9db5ea2d4dc63ffdb9b93cd9e83a374523dad722a5df6aa402ad3d537988762032542f424a9b1c1cd38f09e12112813de0cc7abef9ce523399adf1cd0cd5a58c886d7a6b262d07b33d528468bf524db0dfef0644d18c4eca789f63ad985e552b96dd2c12c67d290b5edec313cd84c0d9cd236041e157e2cc05f0d52f2daa71da01b6bbcfaa538d8e082531c4eaaf287565e74d781ae22bea4d705d710dfa86945e218f3d18a8f13fb21f89cc10caaa4ef4ddae0adb9956199db18e7736cf45e35f91647d840d63bb42a04209f78e962e2a6551db2aeae6e59ffc248292cb8b940f7c4c65b755d1c95e500ed083d77995b288542a3147314fb62638544506e4ab4b8456689dd0f0620c53d285a6ad1328f1039702440c4675082adfb63af6a0fb183dbc8b113c09a983f9080bf9f002d21d350258ba957400cf188671e713b5926cac6c1a32f1bd5917a137e9855cfa6ce7a586373161d874c40cbd21a0bab1e43b8d56dbac18b0e6a2170482cfcb51606cbed760840e14162b70a0443013504e5e08d884aa75fb3e046f5565d5a32c8797a0a933a22c95c0746e4444163bc9c97cf6a94647b2a57f1a7135912966c57c72fc6d43d17359d5a76b7f0841cc32373eb9fc3f45298a6e591b17151707e361213e6e769dafa0c78710cd3b7e69aa8b06034ec114a56792a2651e6d8f7bc7b9ebf36e178b6ef57f9af551be9069c72e2339d1179caeb217ac1bf2d2c57958622e185b07c7a677160f5e13967fc9301d8479d4c3dbfd49e7791701c72baab35ca8756cfa1e5e5445ed621264084e77bac5152342b0025be0464b89a454f8d328e7a09521f138ab52ab607f47c332aae510313e100efde29aca75ae39f084d22f4c6d03142953d82a85ace5f457d9ea35df36414a77b9c1a7ddb3ee58840fc373011766b1d7bc3b0be84b1653e7b37aa62167fd0b60e0d7b598b14f5407340bd2e7b38f10cb2baac188ed884c7e360371d9eff499a69b771998f70619c52ad8a21a36a31627d08ff87bb90a305f6ace35026043ad0c7a95a1cbd5f296477fe7c8a96d084b11b9a819846af39c670dc3d449ac05fde830d9052260caf4fa025d8293fd2724320bdeb8098426a9619d0e1b9c5e798b8d237df66537269650372d160a195cb4508f5956fe9cd333b562ba0a11af91105daa22e408e4b6bb591808a6152bf8135f74b8ee946ccace99e6555baa852f7aee122f330ddccb6600365fed5bb2c239320461c74fe0a32bc79826646f895869da70c959e57046b3f03c4b937bc9b555645b4f27e81659639ca987652718b48beb57b2e273c54564995d28f4515ec36c743731fcc346ee7539c74f019778a5377661354f5ff1643c76d5e29b18dabc6baaa72c914253e2c018fce2c2a31e5d29bedca3cb955f8cc5af29bb69174456b2ce2ab9e52b0fa9e7a606729050d6eeabe6a620dc188283d19a1e494511a8d201705b5a4a5555993b4b688bbed1e624d2c798742966136aaa104a3436db3b3ce9ff57a97bc80739b9b08bbb1d20161dffdb713bbd998ba993dbc876a52884f7cb61f09dd0356bf76babae37fdd0b78fd53dbbd30"
        )
        val state3 = Serialization.decrypt(TestConstants.Bob.nodeParams.nodePrivateKey, normalWithHtlcs, TestConstants.Bob.nodeParams)
        assertIs<Normal>(state3)
        assertEquals(state3.commitments.fundingTxId, fundingTx.txid)
        assertEquals(state3.commitments.channelFeatures, ChannelFeatures(setOf(Feature.StaticRemoteKey, Feature.AnchorOutputs)))
    }
}