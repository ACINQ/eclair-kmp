package fr.acinq.lightning.serialization

import fr.acinq.bitcoin.Transaction
import fr.acinq.bitcoin.byteVector
import fr.acinq.lightning.CltvExpiryDelta
import fr.acinq.lightning.Feature
import fr.acinq.lightning.Lightning
import fr.acinq.lightning.blockchain.BITCOIN_FUNDING_DEPTHOK
import fr.acinq.lightning.blockchain.WatchEventConfirmed
import fr.acinq.lightning.channel.*
import fr.acinq.lightning.channel.TestsHelper.processEx
import fr.acinq.lightning.channel.states.WaitForFundingConfirmedTestsCommon
import fr.acinq.lightning.tests.TestConstants
import fr.acinq.lightning.utils.UUID
import fr.acinq.lightning.utils.msat
import fr.acinq.lightning.wire.FundingLocked
import fr.acinq.lightning.wire.UpdateAddHtlc
import fr.acinq.secp256k1.Hex
import kotlin.test.*

class CompatibilityTestsCommon {
    @Ignore
    @Test
    fun `generate data`() {
        // generate test data
        val (alice, bob, fundingTx) = run {
            val (alice0, bob0, txSigsBob) = WaitForFundingConfirmedTestsCommon.init(ChannelType.SupportedChannelType.AnchorOutputs)
            val (alice1, actions1) = alice0.processEx(ChannelEvent.MessageReceived(txSigsBob))
            assertIs<WaitForFundingConfirmed>(alice1)
            val fundingTx = actions1.find<ChannelAction.Blockchain.PublishTx>().tx
            Triple(alice1, bob0, fundingTx)
        }
        println("funding_tx: ${Transaction.write(fundingTx).byteVector().toHex()}")
        val bin = Serialization.encrypt(TestConstants.Bob.nodeParams.nodePrivateKey, bob)
        println("wait_for_funding_confirmed: ${bin.data}")

        val (bob1, actionsBob) = bob.processEx(ChannelEvent.WatchReceived(WatchEventConfirmed(bob.channelId, BITCOIN_FUNDING_DEPTHOK, 42, 0, fundingTx)))
        val fundingLocked = actionsBob.findOutgoingMessage<FundingLocked>()
        assertTrue(bob1 is WaitForFundingLocked)

        val bin1 = Serialization.encrypt(TestConstants.Bob.nodeParams.nodePrivateKey, bob1)
        println("wait_for_funding_locked: ${bin1.data}")

        val (alice1, actionsAlice) = alice.processEx(ChannelEvent.MessageReceived(fundingLocked))
        assertTrue(alice1 is WaitForFundingConfirmed && alice1.deferred == fundingLocked)

        assertTrue(actionsAlice.isEmpty()) // alice waits until she sees on-chain confirmations herself
        val (alice2, actionsAlice2) = alice1.processEx(ChannelEvent.WatchReceived(WatchEventConfirmed(alice.channelId, BITCOIN_FUNDING_DEPTHOK, 0, 42, fundingTx)))
        val fundingLockedAlice = actionsAlice2.findOutgoingMessage<FundingLocked>()
        val (bob2, _) = bob1.processEx(ChannelEvent.MessageReceived(fundingLockedAlice))
        assertTrue(bob2 is Normal)

        val bin2 = Serialization.encrypt(TestConstants.Bob.nodeParams.nodePrivateKey, bob2)
        println("normal: ${bin2.data}")

        val add1 = CMD_ADD_HTLC(
            10_000.msat,
            Lightning.randomBytes32(),
            CltvExpiryDelta(144).toCltvExpiry(TestConstants.defaultBlockHeight.toLong()),
            TestConstants.emptyOnionPacket,
            UUID.randomUUID()
        )
        val add2 = CMD_ADD_HTLC(
            10_000.msat,
            Lightning.randomBytes32(),
            CltvExpiryDelta(144).toCltvExpiry(TestConstants.defaultBlockHeight.toLong()),
            TestConstants.emptyOnionPacket,
            UUID.randomUUID()
        )
        val (alice3, actionsAlice3) = alice2.processEx(ChannelEvent.ExecuteCommand(add1))
        val (_, actionsAlice4) = alice3.processEx(ChannelEvent.ExecuteCommand(add2))
        val htlc1 = actionsAlice3.findOutgoingMessage<UpdateAddHtlc>()
        val htlc2 = actionsAlice4.findOutgoingMessage<UpdateAddHtlc>()

        val (bob3, _) = bob2.processEx(ChannelEvent.MessageReceived(htlc1))
        val (bob4, _) = bob3.processEx(ChannelEvent.MessageReceived(htlc2))
        val (bob5, _) = bob4.processEx(ChannelEvent.ExecuteCommand(add1))
        val (bob6, _) = bob5.processEx(ChannelEvent.ExecuteCommand(add2))
        assertTrue(bob6 is Normal)

        val bin3 = Serialization.encrypt(TestConstants.Bob.nodeParams.nodePrivateKey, bob6)
        println("normal_with_htlcs: ${bin3.data}")
    }

    @Test
    fun `read compatibility test data`() {
        // data was generated with lightning-kmp v1.5.0
        // README: it this test fails it means that we cannot decrypt and/or deserialize data created with on older version of the app !!
        val fundingTx = Transaction.read(
            "0200000000010227c246dce8f97163bbdac952545f5bef7533ba996d1999ca7218f6162b26646500000000000000000037f59f6f42fe02f7d8bc0fad680eacf13067b246d4ba5ff4e2ba5dcc8111c0120000000000000000000140420f00000000002200206a06617dd274274b1e6a97a79286c61022f2dfbd966c0c2716cb7617f8fc1fb302483045022100b11497d97948a3730514eea15fb287c6154b18943ba348bd5e226543b8cee6dd022010cbaff1b0b630fe485196c3ce9d80121ad1a41133a8b3276aedc9a758903ff7012103fae6fc75247b38aa66d498cd3ad0e80dcf728dc1ebd40acb6f58761f34c827f60247304402204c794971c34c799d2661871aa6cf6eb1ca0b1bd41534bee4d6f482218780c742022038277fc85fd40d2f057ac156783231bd367a13c86fb2f949f5a2a7c64e3c11ab0121026ecbcf2adb969c729f764121e46070e003887cee183daa7bf6ebc7f6c331effb801a0600"
        )
        val waitForFundingConfirmed = Hex.decode(
            "bf4114f7a9b75f1e0d6b61a079cf88c3d53584421769dc8952ea8d07a159a5e1993ea79889de310a5b5a00446c7ec244a42d906a949c3e72b6f19eb54f13abc7f079dab4fa657f486cd8c04b683b63ba52f071867e3c11dcd9a8046a53067e09724cc1d9f36da6a5d8120b4526a91b97f8f76cdee460826e679a8adf105be2798d4d1abc9fc43e068c669681a97bf94dda786a5c36cb4cc1dc53bb7cb18d54c7e8339a05cf37677f9b97b8cbc2fcafe9a5537aeb8d39d25d49a603de5ce30d792a9dcbbd4be5f61de153fe9f40abfa8993ab534c003a9070b5ce9312c08ca3e9608aec567401264ed0905da70b44ac6a8698bc66d6082332dacd8d4783bf82612003071c879ab14225c3ebceefab59f3746a8aa34fff4095ccfda950d46e8628894e3c801b70f36969c528620f489173b2e10c74d7061e54c8103b4e8123f7bd4fc8529f31751c94560f5a8b7727f6802277538ee5f665169df7af68ac3d0967b57145c6a6d7388c5fe48f6abaa87641fe9dd5faca0d5150108c60c5ef3879d84332e2fc2995c16b2a293dbaa30fe740a86230a0f8c7aab95dfe8e6ba6b2e4328e8d1cbe6c841b501b6cf389e77a4fb38f0c81464193951579de035f15b3a7c08cf8d66bd7591d94d16f0b60c9126dc83c03dd625fc093ac998d44e166babcd1ec334ba23a6b7f8f2ae3e185e7d6d30cc4f27a815f5e447453961d58267e502df811ca85aa345e65221a25ce37f7d756085cf8e444c1595ac549cfa3a46aca5e5fce17e3fd6911d979ec568850b5651d5106ac4da270641ed2ca32af4836635c65ead3c9731f980e675916608eb8e0481c5d66fe6e051ac18907ae99c19b81cf98bf378c82b8ca571ec1c8e2b6ad38c0d38e7a766b7064137e60ef9ee63e3e3b5bda57e636370473fcf697ad8014966d9b1ed9f4b94f1eb698e8e661fcdf7e218942db9f8b287ff2776dc084dc00141344d1a60043dfd89f80f01529e398239680c1f805bf76c74a0a7ab26e103e1697e7ad295e7e0294a453c886c730f8fe2971c6f641ddd31b7bf309c563aa801c07eb9e850ccd988bee14d9a8930c56d898249d0abdaa54e76c49e0f607efd791c8bf7e0a9d07d16c8eb6dda3e5785763a33124ea5100bd906c6de759e5bbd8bead4b847a3f6efc1a889eed353b8ced4823956211c3d275db2d973efa83ddf91fa3fe2135b6ff1cab744f40bf169b6be0a5435fc5c144f5a8da233e30311051553b9db7c8e5c3d11dc13c82498daf9d23d2c049662f3839d153ae5b31fc68fe137865aec07ceeda96e5c75aaebf229c18b2fac5a3fdd50bfa1a747a3f8883b401bcb06fadaf3e3bab968ab9513783068f41bd351677794f6d1bee273a79073254bcee66216e88852d2f0d743c5a5f6623309e70c75b1c81c6f757173001bd01e3a5f48ce365164a46587242d51c0f5dfafa9298955773f26b6336c3a0bbe944b6af4439263e8175e3ee2a9eceed575c5610588d8972b4d5565e25ad8df7c1feb951c48ec03c75985e93cf0da9371b9f602c51e429f586523128981bf71b5bf8accff599b3905aef1b2a6d8c8afce0642a707afeb816ea9e5b2fdc16c1edffdf771a4491d40143f9bd77d1aa2a39960934103e0ebdaf18c9946f6aa4e8117fd7457cba0ae16fc16c57746e76854d275fe469bd57b97dcc56be8c8e3b6282734f5746c98f18927eafacc279ad366755b4a82576f4d0446c51fd50f40f7e37ba74245bedfe63e74c348033eebda4585df33f629cba5ebfe24da8d936729a7a4cde62e74184b5ec4498ff7ebd97bba5905a3351175f8297949971c171ea1ebbfdc30f720761774a84759cf3feb4d90eae7cee2848d2de14bc06bd24eba5b92a8ffb746246dccafdd1889b259755e7cd5b87fea056a2c0195f9ac760543f1e5da7746c794ffe47258ad3569d9d21d91ed9c4b8a0988b71c732e7bdbeb43aa867f873c72b8af6a3483e9e4a4b85eef45056da6cd048c1b1cd9bff67955e99a5d6639861843266849ee64697cc770ed2c40e1c931de4c0fe783df9b9774d77bf0c82889797ba5520dd37fc7ca1f63ee1289962642b5056de7d4f476cd1e81dfba8847b7ff10d7914c3a0292d913c6b0c2ec52559ddcc0c0779dae680decf6124d1944fe663d669ed8af6b53022aecb5f92ebbc6b0635fc1a2f8aeaf8c5e3f53a9196f35e3f1c45bc872db0e54438ba96be5a917a16be60fc717e44fa6095614eb3c5f2df15119af541345262ef87de4cabc0f61601d6c450998fe0800bde12b1ac79b91385daecefe29d5a15ca68916e54cb9516cd9d0245c4f05ff305c71e45c2b038cc719d7ba82ab10fba65e638be0d8171e6ba092233b040cf100e8274baa64b2abfcfeebd0a551cc8278dddd0e276ceed1c54cf6c41f46d0e7a97bfea12e370b8579d0ce71388ba98cc1bef68d77525d5807f29f9bc9326a28320e4c9ebe05b1fbcfbf5534e1421f7cbff0542f63b83e17af29b3484c1544ee6cd104060887ee1ddc9731e629591279e8b04fc900b33a0b6ee0a20f08aeb0e604f298b7923485b3967e69f1916b9f0f565943a43f17ff769716791f4111a4f9a8195cc47a01e5da507e065ff4882029399696dbad7defc50099eb5807379ab67ff9e309db9d380a4049ad0f0a90cbb58e1035bcb2dd369d0122907b326c22d0ed42611b06ba0503ecc80c6d83005f08e9555a3897b73b7d9532ae9158a993b49c8d1d2fe2c5e1261b1cf258321886b427b4eab3d77f13a70a11573064cb470317266481a13dc35341968ee43828eaed0f8f4d45647386a680965d2f75795c6d146beca34bf887841844a4c3a395ca5b035a2af60efca2b19247343d193a772b0399b768623b0d0cd0f8a1a7affc1e112dc7e280f9b3421438f593eec650c640927b02bb2a769761ca1d99c8c0fbe41ee3b5d809f97b61f3f926eb861bc27759af84eeb9ddfaa495be4a94f8ecc0b48f853f62afcebfa133129accaf7a07240544128713faa3503a011755138aa8830e0879fa96b8908290b47c8ce2498c1166e3f02b7ded962570224a9cf9610bfc3af73a91f1dfeb2033c7efcfea6181c8693d50b66032d3033f581780277a1de0deefb786eb9c780a271ae1de034ef205072c0eb0532d8730ab68f6a534a67a975415571356b7455780c42ea55bb78bf77d2df840ab1491a26f15da48a00902031185628d4b97eac2a4da7b6b06fa19e21c67eec46e8149b888b9b1b57b8e9cb2fec54a5ed5810264684fcf89abb626ed74f586bad56f74da53015879196a49030305e99faa328493894e7552ee398d30ffa3f75ed6dd311b280d8c326e40adb02844620be16398c255ab8ffcd51e70d7dc5093e77266daa1b3c5861648edf3389a61592b2a33f1d6f56352368f2a5e71f02b90a1a6c2ea16a1f31e8f39c49224dc516d13cb5d1179652ca394d2f253ac6d31d4da5542bc0e8b7bf0ca3d1f75db47dcaa5d530e73904946a8ca1d92e17afcbafc10b0c08168d871ee60a00523d4f49626f76cdda0850b8d3ce021329a9188948a6071d5962843e645eeb69f2d32cb89a330f031235901f2c3e0e38c1898a5adc5dd9213be8f8bb55a14db8d5999b64c200e0171366b89c128c65954ff20bca3441be61f882ca1414de4542e91ac0d3a22f73d251b63cd7c71d291ae2f43dd4b217de1738507a582f06d65198a61e504e53d12252c329c38309791472bacd70d755796e9089a42ced21f5318848f04759b003367e750d3eb2c6479cb5f73bd20d9267df3ee456de29bcc89b5c55c756f77a8933f35fa1d6943503814b13d7e24cfe2c75da3380c0d055c59531c0ecffad5f6c980a53e22de190e0802580c05d6ef6cb9c063706c6956b4f8db3379fbaef669fab08cc9b2c5622a6efec0f584181b601be5a1ce0ad2d33f886f5b556c5e79cb42ce0223787dd553ab34be9fb662058a90d0ef8ba5846f33f312097cf07d1eb3e44567fd4948a9caee5807fe098e73e9ea13c4d7d99f58593b436c728e6aee03d4f48dd8a617aa3003dc880ae739b6567bf5224a2911d8d148a465cd566fcc1fdcd6201337cf4127e1c0893e9c9e9867ad73a88504107e833492c413f05764934c017a0a9daced1d7e87701fdbb9905012a9fe056f5334577830cc59c0391e574dbb45185b1c920d0fe114abbab1a40eaecdf395a7e85775130a0e50fff2fad545a51a2f28b51fba6dd4277f8f699d2dbe3f925f7676cfd61e84766c3eb5d6e3ac817da59e165d6e59b1ebdf3d270c5bee8f3f7f9024777087bc75da20ad93f6dfa1b772108053add28043aade190bdbfb5ce3227e95958af240cba7f5fcbd504bf0f68154888c255d18c2b555b239031f2b5b2198fe74060c969153f6e66bab533dc6c93b7c09d82ec1f57c128774666aed3b243e34ad018c0ccfa59bf867056c9bbcb5e56c845faed9537581da8bc895499769cc3204222b98c55c45536d6ca59ec1178d71d76caf46158a4cbe2ff7d5a02093c87f84f52698dba3a91bbc6b6031861b57109ce030cbf3f33cf652d1f3d5249d4fa1bcfee212ea5e7dad1cb1f747f8a42cabc8e7aa6b65817b5ea377ac4aad4c8f18102d43a05e5ddbc2012de8e72682bd3eba0f4eae1bb2ae88cec2539edabcdcb663385f8a91b245dcc2cadf5bb92657f93b61a40a9862479af32f027eccefe79824ac8e9e16a0f3b18215a3ed40bef78ca65217a0397c17b485197972858cf40a5671005679b54b3bae07bd2f935592890b3757fe1505feb8afe565d59a1d3c6afc81124b7cb24b3b9dc86c163af44ecea9da9c56d0b34a0b8bfc8467534a40fe37ca38460d69fc00f6f0340c8b8cbdb6d098026ec0c4a9ec6814203c37d6adbfbef89229ed4459875ab5fdbe4e5c650a809b202aa91a4c216d9b6f634204c41f3e3623cf8b72a195ad4a1b74fb032ed261d4b3e593d4d8e7fd396ec7028b5b920cd029c8977790eef7e75d6314885a003837c435fd77833bdcc2960827050e0abe167afbf267bbdf4f76013a74f94fc4d5e564c9ccebba0eca17158f942a2ca0676f35c8fcd9396d350f066fc13dec5369a7d46b2e54ae60f7d90550c3fc45ca25215902ca5fdd6e53b07c75de68074cf40c9db9ca71b63f89e4a79d2bfa563d6caa082d445e51f6baf9ce274f6993f4ce7d8d038518588de96d2450e6b153e1041cef8869ca1cc4cd7503ba7cda7edb523d1d418e84aa6b63f0a71729679fda3c3f4f050de86ff9c13fe550f9ebf56ce7aa04b3935027cda288bc0f8eb839685adcf84c499ec54cb229f14c9d8081ce5fcc9c5045d9617e5c291671431ec1096fc93820a4f702195ac55885758eb7a23d2c052e688b08611bfa2ab53d4076a67d6fc8418d7b4ef5082080b1768e713e022e9b382558a779cabdacdb7ff573f230aa31eec4d812468b9f78f9d0d80de1a2a65e42431cb6df736ebb1f814422b691aae901ac6a93023d7fa332ef67e25f6f72362287c2c16b51fb697ea32fabdd7b594ce3d5e3372b393468055c4f02649d3a95d72efc375716061736a4f28d248075b0c148035a673a08f8d11bdea2cc92417951e6570b846aa073a9a0af551763e718d4ae6e20538f4c9b80f2ac08056ee34c1c7b18b18fe95aac08e477eab252755428aef434e927c358f07d4160cd6d314d652bf58db5ca9a1387ea74f76dc61a6a18e093ea842239ada654f385c5f53d0e89b1e70704f5b7689f72384d0699deca46a91c060dd2b2fd6ecfdf4b72c1d0327c02ea50390b66f1654ead4c68610fa5a26a968bc732698500acac537af89b5d7bb9b15d3e0782fb8837d00c169716872e130a18f93bf78b033c38fd0b33ee2b65111f043063f8a8145bf88d7879868055be3801d833e84fea7f7628e4375fe2a79b001b38e5259267b34bd953f3de52a82dd16684a9ff7c5434a574f1edde98dee1df925d879d422966c10f424b3a0502265e4c0579f22afac8f72ff2349e6c1780d4350d7be45610c8205320cc5e388c9b503dd359134c08962f099ed6e9a02530d6ab86b30c4818311f485621df3d66515e23e06703544c1af08fd8eac5e9e4e93c5c355b26ba0ea31b2bc25e1533ea5534189597c112a9aee2003f7d69edb9d400428d8dc199a825763e69ff466f3c65a7df1e16f0f253027deb6478473b5c353ad9aef9bbb09414af93a686c953a6d19dd47514cc608a57dbe42034e72d99e9a4a5388c5dbf06b8c1d35e86d70ee92470bf2bb1c8604f17a0fd33a3b9514c44335765ff37d20cfac8e19614d80d14a9da9d873c3984f6eccada55c6c45a6a2ab0bc2c6277c2d6db1110e65728d032048528f39639cdb7ba6109f7111937464d44852414326beedcad698db0e79211f1cc25d9aa8a084d02999436c808815edd798b5a20f7e90eb56ba36529943d31b6512e81503d07da7ebf5821d078730153158a32cf8b120318c9b5e4ba537bca173f73536738f7061f6b9f725caf83677cbee55f1e31dfbe29dd2fb53e0caf6921427b42d8960edfb026fdd0b876ff0a865f2e050e0510d9fef7ebee5c821f823aa97a48e22e0f7433065d91f2df607d60347a75e2fe5023d7c694c9d2d8188ed1063f96e481e0ef82bd7fb57eb8210a050a204712487b32c3aad76ce4392ebc8cfac84630e4d3324c8fd0d8b204f32f745a6dc28b5f6df2aec8170f5358a6995b4f883af647043a6665ea024657d9b526b40938c67f844db877e110bdc3a3c1b2616e0c2865da38cb117a40ba7ac257c9f5c1f77b730c688c7d4706649a1"
        )
        val state = Serialization.decrypt(TestConstants.Bob.nodeParams.nodePrivateKey, waitForFundingConfirmed, TestConstants.Bob.nodeParams)
        assertIs<WaitForFundingConfirmed>(state)
        assertEquals(state.commitments.fundingTxId, fundingTx.txid)
        assertEquals(state.commitments.channelFeatures, ChannelFeatures(setOf(Feature.StaticRemoteKey, Feature.AnchorOutputs)))
        val waitForFundingLocked = Hex.decode(
            "b38be05081f7d28243f421d6314d358531e884632da14778054838d03eda84501e2ed38cf51ee3ee6059481d24458efb9c9ed7f391c612cce9aa8576c2d52002ebd713a3f2127e75390ca1e9aa56c63fdbc030fe6d2b470e8a4270a5ed33643da8669bb5213787b3f3a7259768910219dea15b39340f2aa083af5c21422b42066ccae744c20e30163388225aa974b44cf3153f23de9b325536d85368a894cd4450113469ed17994fa4ce45a58cdc3c05652c2a2b30899c723e4147fd3159f35cbe3782e0d761e2b298a00e986f687a0eb73592472fc2f1afb32b37568d787e6b6c4a2dac966149436e80dc094f21f485af45babb807248c4a4270665a166c4c37b26fd97db691e42f6934df9b0b30237ce86cf5d16b38ab455e513cd7838a93315a802fc7eb3b58f102810f8595f1e351e70c6b55d6a280bfb152141dc803e3ce9ae09c718f62fd1ceb4e830291dc062288e09957378fb96a7e8d11248778ffd5c3bcc07535034a28b10c41574411f9313a9fd17f3af5db25a89a6d17b6e0863ebbd7e9b6e227572a17a9c5cfca1a1bb4aec870b19e88812e9906b16022bb97f23f37bcd22f4fc11695ceaab8d3fbb5b56da173eff6e80c128cbb1217579c7718bc920d42cc1b36d9e35e4e8cf71d2e28da044d9bc1a4419f723e7fa9f084ababb92d0dd2d98a13c421427bfd7d4fd3377a05c7b8a92b988523c35f59e84e19fb14d2037f0ae285d3a73679a523f3fa16df1d8777c44ede353bee0c46a3db4585946c8ef2bbe010d870a7c0d871a633b312db8266176d9b9326ea2cf8613936264914016812446b38d3aef4bdc6f18e637efcac1feec670016570a2b4272c4782bc04d84d1b127fe972105a18efcee31695b6617332fcb4737f3b7467be5071cab1a14abbfe53b86ae0685a05b38fac17044d1983c29db3cb5fffca5975ecc4bb5648aba417a35409e6a36969462eac3f74b26e46d99856261dbcba222164043ad1ad3c6a6d2aa5f5e430846e57e85ab9fe4c99cfd318debf4bbf4b9c75bcfe6a1b49b124ad2f5b159f7a9cc03f9d6352513a119acc3ccbb3636768c8654bfa7046e753628bf4245d525c07046f71cf1924123f1e2956de05766f9a2ed99b54e7d7136d3b2fc8e271a7560d0b6796615e6678788b45cad82a623a7115477efbd6a57e4e4587b751275c7b96e3789f0d7b04370eb12b26fbcd9a4b9d4578ee0c4c60e2653b6ec6d198ccf42eb2a62664193c057aff709890c3d7f1fdcdc83fb0a8332a522985e20980c4712ce1cc58f44d7c75ea73bb87be8fbb20722f71b175d0a2b187433c9a68050aafb6ff830f9309906d53c368138fb5bbca6087311dc604f0f1ed10c03cd1e20173400ab9cced4a3764d41d9fcb3da6dd2ed1bf4783cb600628975eb00da953064f31ef2bd072b32a35a3b9e853e2b49169db9b75a96cddb2f8498226d032a17bfb74960a0a11721f75fe823bdbd0a4b26e106f0f030fce615862fac4e0f8f6a37363d5009b775bf6a7290e50d2493cedebcc30a3495fc5f3404e6433ca83f5d0adcdbd9a0d7b590f964d75c7bfbf1662b0ef49438894fdb941ef2baf18a98ac428ec6254b88eb8e3c28343d3725ff12f115d7b4d9c110a125f6165bc1517e62085d07c237edc769276d7784e0f5a73fdf4f7c4e369f0a7b838709d0af35949dc0d65089f23d6d938a3f3d81f5dff4856b447b740f2007de9af7f2a8c9c96b42a5349b025306308ac9343165ac472a7369bede698185963350654c54f11266eb18e09d562635041d930c38b04420e49440828df013d0bd646f950a5992fda38d71007417becdb08d24aa4776b785a0246d5b4ef328dbd9ad0497759b5f2493738b2bd6541be3bc75c41cb7ec7db2a106c4adbb486387063b2fba8edad631fe0a08099c6e7e75d4059bcf515ef4289d6a0683addbfd72d5ef935f3054361b72d053e85cfd34d3d2be10ff1919f91811b4b9ee2effa527b5120573a5f7080f743facca39e043a3642b26c39d5afcaced7cf59908b6612a19ec949da7b5af901391c4df300c0cdf0ec4b868c693d68f7db373846e0f9ad833312e8b48c0696e3d3aa30e9cb10dbfa4ea691903860fd3c3db31235670b0562720f1b9eacf37bd8ad3d20f1e864c392e4d565bad635734ace5c63e2b9fd5783d9f457780f9f22cfed7a13f04a2a513a259a2288dbb65adf0b65871a788c82e39c5c4fe6a5b279202ed244c2c3b636dd259f630aa441a01a99bf064a6eb8f58a752548ef746754797d688773ba6fedf788b21ab7019af733d687008661939158c3c60b6bc5c16c7d5d275414b6eecb352e4cc3ec83372e984c9ad9f504a4249da3a2f6f923cb0411aa8b84c28217050943282dd183575d469b4315e4093db241b107569e7d4a8c96361e8c58db9cd790a4b8c9a7279c179a6e062ab35fd965a929844d684f6e4c13f7d4b7c34ad912e0836919bc7485948261b8edb931935431aac7a99dc463d6173eb69a5158b5153155e7b8cab29215c9612192cca10211aac7b381876982c2d602e21ffed690353da083544279bdf336c248fd721304ca5629406eeff3bf3caea67bef16b11707ed7e7a903a0a31d6942f1c0d9831c80377cb29b8acab4c1766d9f8e375303cf9d1b5267c6264dbbbe20245bb62e2cec7decb2e90357b3553a822f7c1904e36fea55fc2d0598cfc9fb7832267293e73256702a6fca43c35e0b85817dfae620146bb9e0a5a44140ddf36bf8eecd765d8716d884083f747f63ac5493d7364e918d9bee54eaffdc8ae54aadb8c95aa60de0a94794d17c9b74959fc24b86c2b20e2d260878da2e96bf89d3fbc66b53fdb5da7ae63a249530a2bf8a476717bfc6be810b647089a5c83dd09bddaacebb38df1a5a5895cd4e60ba51dac13a5ac52e986d66768db5eb09d35ddd39d4fd294a4d342ca65fe7c46b3e560b3644d1b1cc3547538d7acd3e7e1441c4dc9255c3d9c4a011c379244916597d02b6250a143b4e28ab8c6756b55260fa7053c903b8ef508ab6de0749cde6c6ceb847210961540ccac50fdfc752e4f991c0dcc342e6dc43a8c84733243e43e012d297738c0e839a0214dd0c258eaef97dbd27da1568cb3d662b0fcf0a5f2ec8a319fb8934a9748029e01fdf4c98f16b9676bdce4c0c6a256ec9b7041c0bba19039f3979ec9a52796a2bb996be81c351fd3f6b94ef8f5bd58d19a17081ded8a629158d35ae3e0a6e3d30fae08f04d69cec9d7d6902937c13ebba03747e292ee35d70fd7c4842fee3031cdcaf2037e2c0e8f65eeab08f39e1d94c55f34bc5e3f0ee97eba1aa0afa61dc966990bbf944262439dd17f0ebc28a23b482e02e7b758a54e828e2650456698b4ab556aef55af2c450738feec556264c33927a456269ffac3c5b8e4529cf52f1785a62031e3875ba0fe1fc7b72b346fe0c69b9fe13f0600b82b4527b8d5890b195a6982bec6775dd61a1f1c59e61cf3c0d4e5383fdc9bbf29561e29b4ec83191b0ec06cf1581fa089cb558b89904c903b506374f03c3013529d90cb532739a11c92a48229a4eb590abbae96e5550fd9f10dc8d17a9f4af7c37c553ccf29363952daf32429d767d0a2c97e5a551d4ded24e15fdf3534e438bdca8957e90992ace8213a4bc7d3b7bc672106efec7889bdb65a38597ee316187494711e74020ffaeda21e80fbc5298b93a21bea47ac7d60e456d95dcf4be121be9a3463caab604c72147eb68c1a816c7914e66331ac71e9814c3c7b6a917f40f92eec44246988f98a756d0760d23ef7de0d5210065c4175e835164a2c61fc5a355d83bbe5cfc2766c9ee77893feb060329ff3c747835a2cfc31ad59536c01dd4825f044227ec0286997a5a02b49040e5882bb91ba169da52db0f5d5c9767fb325be884c8a93c1fe8b30473faad7596ef2b49816a3f8400ca85cbfac013e2a3f884d5a3eeac0f0282c119628960ef71e8b65d4dd6b0a7002f7f2a669234fc592ffce1804c570c363e449398579cad9bfca1c8f21bcfcd91c1286924fcb84f0efb87b8e2402cf5771d27fda2615dbd0cc439152261667771237134c98d109792188285a3ed84c02adb7e9374c16483efd5c5c2497a6f4ef0cf24f729d302420f74924e3a5d2b193339b9961ac358d628c6f49160dc5ac54c3c52a8d082f4d4ac376a3fe23bdc408c0ee7f9575c91bde727deaa42a65cec653c3e821a7cf2ab9873c4dec2f7b8b070e37a78fb15aba99d205f934cd30f4f341fd2a19f8de769941be308e171b1235eb969f305b06923c3033f84f12dbdb9610168eb87cbb58d13679bb312ddb660f5acb790f9030bf034a8af73dd7d8f72d2008320bfcfa909439909384bef652a436a85aa6a8ee050b44a6237adc9ccac78ac455192e2fea26abaac5658f4d9c5d38bbd613c7dee9f55e940a1fce410fe5ff82cc79a536ae6dd8bc03ba4f2234a1ea98a0f21d4fb848b0e2b4c8debc723ba402265cd930ea89cc045bac5f9b155a04e4e82e1b72f60a2de1b632be82fdffb6432aef93a00341b310a05d4284d3f16e003808b88da7b00f8e3fe95ad86b70bc75ffcfa50048fdd52fc234d67696de9e5e9f2fb255b4df70bc35df3cc2aaa00ac8df5e14c9fdc82d8af53349cf6dc0faf96e947d369615feaa762915fa1723f29874120ef20306d0984718d08c745aeec636ccf67650d5ac25a8791d5901c0844968dfabfe38cec00cbe1222d97f4b716645897b5502ef408fa428f03f3cf6e483e729477939fd49332b0ea2df792db89ce326d0d9f46317a002530f1e2e436ed7c7a1fcd374dc8a939f222405c806f8bcab0b67649d8ac5e5cf89b9206af247aa53fc18ef4bf759de87c6abe331dcc049a994eb39c934f8eb76c7392135d22eda274f72edd27639009e86340581e7a87b67182ac666be0e7700b00b8734a137946678c23b6a47d90133849f4843cfbd4518e2de2a6187bc4f70298a2c7bcc1a756212d24b4e5638443c810c36277b3cd2a3d6fd9c22adc89333c1c2586285316d936a006f8958ba99dff5a690c5958573c1ab467b9711d1f731e35e16a7dea5a19f617faf8e57286c25d6015cd2f7d2c285ac632024107169b0a4bde7f621b7fbd0205ac56a49a533c2f878963b3a2bc0c221cb0091d2343e479cbec7a464a5a242a45c7982af3851a4ba7be0eea7f27a09dc71eec3ae439195c4726cb24e87abb7582886d712ff6fd147a25795880cc38faac4c6f1e4d9d615f793aec6c5b33c490d7719df22687d15754457d9956e49492c224c8d654f3db3289fbfa703dcef7144383a9a75b54032ec613ae51afb0272498e8aad6e71be0be103109ebb97257479a470ef25c797e11ee637c83ec81124310dc5bd5d8caa60681f18788a756719c741d9f467e9b726c063430e19d761479d8aab6e3af104de1a378b680cf164d91eb02f11a37b04a226fc8c274a398df5e86efa29d0a080204b18567b5004f07c68db8f09d2a7fee8571fd653e3dea6d7dc3489b5dbbb89dc537246d4e066cb794ce29c0265308a6cffab03f9e9fa96ea72ac469f678361d68c504cd22d56149cf8f7324ba5900be45516b8974e5bda45d24670e42cf1c325af54f8e52ef07b8973cee979dfb2a58cb9dcca7fb3a348dec115a87ab1dc33832e6175ec17d5b14a9ed3cbb4d945e27d6b23c99191bc3911fd67d0778306b616527dd47640b4077ced46d6963932ba42c5b09969bb00358d640c2b0b4163cd91d22c68902356741fa3267eb15fa84de58c440e06a8cc4e07e859f29ed3895cee67c7eda7e100f70982ed91dcaa749bfcf2e2a2a1aa7f2b0418a88c02f3d13257c20bcfdb18e63a53bb4aca1e4a06afde95b9ade5ca0570b229444a176bcb7adf9ef4af8bb1dffde1771d24865829bb65b7f7f2ffe10ab9243cab9f7fbfca9577759b875cbe7d8b95cb255b47cf712fe33aa085fb7f58325c4bc76fb61d7ca957fc0db03f87b667ec176754bb73a6a16ac421bce3e8f9ff0408803975fe185180647506130028ff15bb6348176c78137e32f8647b899307504b9d6219fbc6f0e6cae663c4340cacbe7e05de9403a42f27d3b8c876247f4ab8b6e83b5554dd990b92203513a60458b417e5e479140ad43fd2cf4da79b79797e772896e29712fa496febeb7a6638bef127680dc384467424d871eed547af043c6e4eb0fb654f1aa81b2762819d5a2025eb2fe5f1214270c334c64546b54be2ff75f5c5394bb75e176923d3e7ec2214801b1610d518c916cae23eedc81c5350b1a8694432da591e938c8e73f04cc2ababa9a68ce24772400f1e1558b60aa006bdbf3a77d8e8075ad7636aaaeeb03d8939f7741f96df0be1b5ea11682507e1a718f81e03a0e044c"
        )
        val state1 = Serialization.decrypt(TestConstants.Bob.nodeParams.nodePrivateKey, waitForFundingLocked, TestConstants.Bob.nodeParams)
        assertIs<WaitForFundingLocked>(state1)
        assertEquals(state1.commitments.fundingTxId, fundingTx.txid)
        assertEquals(state1.commitments.channelFeatures, ChannelFeatures(setOf(Feature.StaticRemoteKey, Feature.AnchorOutputs)))
        val normal = Hex.decode(
            "f2b27a8d778b50f4fe50cb142241d87be8f9dcce786347b5e52272238d7a44d3b791affe139825aeccee076d62ec561ba9d94397bc34ec8e79479d4a8f955ecf7d77888617523a657afae0c012058b97237d106e2a6121f0e561ea404b67783077a9fe957d14baceb44d861c972a1a37d05bcdb05a82767ce45a41d1613245300c10df61ad1b03dfa9f9c09b599f1dfdf04e3427e3adce1972d9ce91bbcc9cfd796ff4f2b44abacea941d83e456acf553eea004675dfa778036d887b9725a106b34cde3aeefaf9ad783f3f40e71af49434874c71d93ce7bb0738e50cc48ed3614f1ead556dfa6068a5c85240e0ac832959f3787a25ff52771674c20c585004ea9f2638bf7f323e244d184375e13313734bc77be77887c42850a867dd1e65aa7fa154e5fceb85b051ce7bfcdb846f9229a7f9a68b95c93766440e4707e513754768c0f325fdcad8fef3d27c2ca8eef072d46971a5e7786440bc6696696032e1d857f31d365b9ac29d26c12c8c24b5fb3722fabaafa760db9cb11df9318afffb2ba31c3c5d695f0320e00abcaa498c5ae971fb09ac9c626436312fa30c7a534ddd5b01a2d3f7c40950fdce8d54efc4c8de96e97db21cfccf3cba7f6151dc7a636fe771619610d430dc55743c56ba8ee247083b812a87eb901943d0a367f6997a9f5f435261cd3fd895fdf684e8915d09bbed39986b66e2d140642390dc4e665e3dd454d1ae1b2f0ab4bab456958eb4cfb4e80003707a8cbfc3aa8f6c849c111f61942831854f790e86e37563c2dc97172b7b1a2312b357af8e6ba0beb1c219c3d938c84cb951944f248425e34dafa9eda0e9b129628e47281543e059848017de3bb620ae3c8cdc14b50103df27a107b30ff408d1648fb3dcf6a4e039eb9de2c32aa1aae567a696f94722a92a9c056d9fc305b66528a17a8a4a5a7162fdff2a93ac2db34df4269ef2127595ad27a004fcd181d81baac7189e63ba395801536e3bef719e26b732bbabb93e1bfea5e37bfaf0fd618016416bccfd2d5f4401f47958e29b75ef873209bf85b6380287e054c560ae09b26e80d460e3c82c7f33d1f019d498c8f7400cc74fc5d83a9c1851289e90632169555d9ad8de61a4abc97f5da81f2e70001b4789e8b8fb3a29daa77113dfb921416aef1b63ad63560117bfb1c24c8908d01086071fedb437465efdd3f16c3d4add8b8a505bbd6184c61010a10eea74e565a9f27ff138b2114664b808ba75a6527273b507ae393623bb7e8b77816655e0fca735b552055b095c5024ebd20f3eb89e558c6c6f6fec949442fa0a2cc81fecba77cf84ce1ef3aee2ffff8002fa5b8d959c7ab90fb0b9a948a164f8806f7dd3ed33462131ff678351661269b7737a4acd166c1cdbba0d0e7919fa55a7dc2684152d413d9faf18e2b291306e0d525e4183cdc3424b92422f582db2a981d2526aa6e2734fd82532d0f53779d9d8b5e2e22e2ab243e637a9daa5f792362646fc9f3f4b16a8ece432ea5de1098f27076ff34af8767100706fd81293642a27583e37c2d6b9ebaf1984e30bffa52aa6e4491a38e3660b05dbe20a8ca1bdf74566bb2d94462270966412882258c20eea07e75fa2f4457fe1011a71f0e23f0aba232c3a1c06c1f10cfc2c0de6d8d330540d0868386d564d3679d014cbd49ff083e371e9e48783b1061666acaf07bc01b45be255c5de9f0bd53c6a96e96fb4485c1206472dd4076f436cbfb14e5d35bcd0ab2d1462396237c7220f8de1f29546f29616f4acb58ec3df0dbc21e6842221815a9959687ddb6a6b5b2731d673d11fc463c4a55c481fd589e5400001130eea5335f7c12bcc45a74446df157329e3234a9a3fb0f42026b2e3df6f35b8840bea78e92842d1ed7b7baaefa21862534f94a7ca0a6a8ebf1b3139f90a65a65cba61cfdd006cf4410dd5bb404fde36640f91d5de6cedfdab371db8758702c16adfab1b5c659f2d4aecb460e80b8c79ab0ef47fc839e0cd703e859868f10a79424e338b5f4c5c2a03639705e220409d3c808efa0ec9d54e85f6c1ac3ec0ac4ee6dcd7963567e766dd16101b529660bba6f2b11ccbd66841076c030e6c10615c1a6a4365d8ca4b4444e1dd7afdb623c26010c5f4ce1903b6fe2c09ee132dbadcd2566adb6bd6c8ef8609180ee38eea1309f5d042160e326d553eec678b5b9b922d7809422a461ab245138e15ea4f5ac915c4147facebdd84a7ec252c561231536d921e58347c74fae16f0262b451434ddbe9a91accd8d08bd1f1d6c138153001228eb432f83679e8f929fea421849fdb8f40833800ddab20073f4d71f54c34fa77326769bec54ef5eef59dd24cdbdbe4c32c7200b575a396ecaabac38a120f04c403c352dedb9f15dd47c36714fa6f1ed4e77d79e31d188f7f42d341c3e98a65ff15e2e077999ef4af26700ff44f40b0be69c3605b8becbd5d2eb9b36b8752c1ddbcaf8acb000e1db53bda51939246c766ed58a6b81dae10b05deed1eb0d3234caa5c0f00d7b3a11a867733dd24b0c437c367f4bf55b5e5cbd951aab5cfac0627c72c568b4092ab728e1c3628692dce6696b38f06b040b91d25704a5d57e17fdac52b1fd71eb6ad68dd860c32078f4d8189bd89cd64c07ec282e42c0a5e39c4b2587776a4e9a32944f490a8f4119fdb81fbd07d8a13256e9a8fac4ec0369c6f60b06d7c4122424815ab85e525b25fd0ed10c6c2268a94bf1b17eefb1bb8f47cc8510d8065482cb9e60abea41cba3db37173b8c5b599713a216f8829957dad2da8571c05a375a83144c4519d9acadef8367d53e9a8481777feb5e2c3901ca364a0a73fda54f153b318ecd48b6d3a653474c56ffeba342a473bf292f8b3ff804e692c661c44ec9fb09e9d5500cd2053ac310a5669affb478897be48002641567acd4c54d9a105363f7ecde96b91ac92d1922867db197e5de0285ff35ed541b3917b4c5d8e49dbc3d730e602f0c2d10119801cb3f1a30ee1ddbac9208b046f74e8e385a4289235666c42f8d0815b547f017d6bfcbd8d2c90efd753eea0a652801829c6a36f2251b311217db668ad3c6332d3d1e3c5df8328889bf82a99aae9c197421c2cb11f98d4e90635666d89159c54211b647071f3de4d1c22e7d6b0f8f57732d7d428cec5ead1fa6856983efae4db1b0b5739b578961089a2f99bcfd7e05621d6e1dae70a31593dfe3ae26064ed576f607bf95de130b7acfb834227c7e05ef50c13e80c678a245b580d842eb2478e25da390c771cd5854d00ae9f1c8c9a167404b3a1bd73366beb63ff5086c72d3adbf058e74739d5c8c74b3bc2b3690192602f0515b8e7d06cf02303525d49238f0de589eef8b426ab738ce978246d577e22f6b5541451aaaaffeecddc40e089c8b380ede70f1b9543380fd7e3971780d9f6c8c623042deb79a721933c2efcd31da2cc4278da36635f6a56787d3bc809de33e51e7a2d3e7e6b3eac5cc5b979f056c4d9370b7b02702defcf2d8f1cf96cabb3dcc5c65473745846f70f802434c15ff2204b6ea509e4419cae114dc58b0360157eea77586fedcea9637cbc67a9c95b98d9daf6985d5bc93d5c9ed15cd3b2474157b52f9d4661fd8b9fce6d7f61f5440920b03280a53aa610db2585951add8eca6e7f3591f0b55e9a01463ee8d0abddb60d741fdd2ef8144e81fb815b536d2e500b989654b94281928422dac6ea9a05b22f121b37c5678a46280b91b6218e36e686488ab4303260dd8d22f54752882d5a823ddf52c422d5c4fe86c50b614e20f80aef856841e7aaafdb708a84f4903ae5a8d2ca398b30f6c946791296446a0debff81bf58a5933d9897d3efcfdb2b78415528bebd05d78a775fb074e5d63a3d555225773f453d069b432384f1c3234e050fdedfebb92fd012b53b449c1484ebea5e90cc88a5d4b23628d66ba35d973ce41dcd69c7935c148ad7cd6e70c595aced7143fd385e44bcc84a623a08d5d2d3096ebd6b5cca3862b97e84c8604b6a9997844b944c8d21be1f460ee1f1dcf71a7ffa4abda11af7449fe1d38c57f41148efdfc001007e8dee6861c12d84ee0450be57b8f9249b6134fe0f144b13fc38d4df747d86fd6e3b06f52afad63c210d1a38bf7a100b5e7e7c99402ed655651437dd9ec0111803cbd6240a3b272eaef62237a2037807c01bd8a5e4f8fee8840bf7b69389a3b151051d1bc0d87ac867b68d123990420cf09d7a46f2619cf4759607a41c987fc2f07a4c308ea0cab82ff30067d351fb8201484224d82664e19d17942560950427365be30ad2a5fffe0012b759b4ae6db04b6afb96f5d49efebf9b705d721c90719f77aba8fde6d022b3832b41898a62053b59ec7303e7dfbb48c95302890bad430f2587b89ae03162953a7950594b3c560401b1602c34985f84f70ef896c083bc489baa00e52facc86ea9d475b1f54b93f68e806aa22b4602f899f4d68edf62f777223f9f77ce1dfedcccc161157afcd07b1a3255304bd843480967949b82a840c0f1311cfa1ce0dd5d3c2dc30e14f64370c65908deaa525a7e1321957a731f7fdddfac3c70cc943e0276e34eb00f9af8c8185684e9f0bc269781b7fe6f5cda165b7f8f6d9fe0ce83b81cb9f143731eb79739264676754cc888851880ca03bce4271e9e3bc93e584d1387e5fd73cf392909130b8dd61f78f716ddf80c52bd99c3262401f5fa225260f220e646af89b4b1027a3fe68707a639477585abab599cbdb9a26847f9e662e465402e521fef68bd0cb7cb49867e03436941733792c17042b04a5d4ffa163bc1aab601a949e5a907779d1fc02dbfd0e84777ce16df85ce9fb1439f10f10dc9349236843bb564c342303b189cd66ff7df6eacef13c7a744d4a0ae9c5bf3a67db8f9437c30fd79d5b2db230a902730bec2e523e8adf93aeeab0cc6aceaeb8e92770634e5e91c2852ebf2221bbccdfb2f7a0ef11d07b6edfcd8629990c511d9db2a22a5e7e279d91a5464dc2f5ed2c0f129e59b62c5cb9dcde0c5d767bf5542f96555c58ab6cd42a895bf14d7d0769cec0172bd9309be44a58829b20bd7e253dcaeac3912cb12e4fa760aec7265198eaa80893360ef8fc586bd25b4dc76a29f48cb69544f3884159b5b670f7b8d614430be0491c49e407aeca076543ab6309c425ef33eedb16d0e6a26912daac947cd65fb1f82df89923df4b32f05547d89714f75b3ef94e8b4c22358fb8e5cb1df5e7285af9a2edadb9603ab6fa554c663717665d27fa14f36dae3c59daaf417e5ea648d562bc04cc82a59cc986754bddfa5aa556ea0cb7cab9ead9050e841f7bd0238364b4de993d1da0d7cef66820cc4f6b5ab97a62b4486336dcc659278578df87a1e1ea206369f874360adcc1adc72a81b39c5c85053977930c4d9ce4a7d707a58ba19d4c1d2e8c2f3530b6"
        )
        val state2 = Serialization.decrypt(TestConstants.Bob.nodeParams.nodePrivateKey, normal, TestConstants.Bob.nodeParams)
        assertIs<Normal>(state2)
        assertEquals(state2.commitments.fundingTxId, fundingTx.txid)
        assertEquals(state2.commitments.channelFeatures, ChannelFeatures(setOf(Feature.StaticRemoteKey, Feature.AnchorOutputs)))
        val normalWithHtlcs = Hex.decode(
            "d81f01fa45fe6c023bd61db673bf6b07cbab733e760dad36adc6c24474fba9408d0b63071c0a4c8e64b70615a540f226f29fa845bdb0cb4e73a0443aeb87e55bcd0a27bdba31d7025fae50e6866ab4d3311f4d2576af8ac2d2d3751a414c51207c9844d4a8761b5e4fc11d191e5230a37a9915642a2580eace9ad260c2aa70bb91d594f413842b2b9e914c3d08ea94be298b04584f507a5fed85fec2d831bb735f445ccd08779e040a0464baa2e95c601df1c1cf333ccf1f61d340a9fbd7df7d6ad0e2780c59d187f6c8f9d1fbab658a16dc819d9f10fcf7c063407ed02da17ec88dac164143436108d3e7e242ec3f1e57942de7aaec89c0dd5c7b073d38ca6f73239b95e6281d4a95f08a83ad13fcb46671baf6eb5ca0e5961989988d2a8063384122395019dc1a3f619cfa12a87f288088966b4d53b8b34235321e5f9c849d4fef07360dae545c743ae9e9cc2ac099e88c3171a488c66fec7b784b41629af01e6bd87891c7e596e3a020c7c23e20cc6aaf42e5ee3cf4def4a890df8d1f0d06680504af92638cc522997da29eb8875019625632a4bee82f92aafd0d554184e079c7a6446f193047ace8f1a277e3692896c496b2d136a508a24e07ef86d778db2e8734ab9cd0ccc490e451087a86af01d86edc251374f28f7905c0f4d57c387c326a8ac4abf7b055cf156f2f8a5370d802798b262aa51b227832eb82277e76e87e2fd939692b82f8f004a616b3e623161d50953b56864ce427a2ed1d8a749dd42ffe4970ce5019a74df2445ba6540fb7e7f194745fd2db6b7709f42ecf912603146e81615c0046ab8298f7347aa10450a8cbf0943adf3e706263ae48bb6bc0af435d318fb607b42b3d130bb4188690b30f0aae1a961303bc21134118057bfe6148b791fe0f94ad7642c3aa063239e5e232099d79f4e20f9f396481d7ad334e8a14973ac62b08f6144632ed473e96e4c05fe24fbbb4bdf208b3af674128de414d4932e8bc99023e6e0a44fc11a032aee35615c9e2a501e4a500064cbb9d9beba4de09115a41a4ec2d2cf0e290dc7e255560c09a8991bffcb8b0502f7490325369a62c3c8799a0d3209ce303264231dbd1bb4e57dc24554441e4ea180722ff95ce29c4182f20bf684a8762888abd50fe3fe8dbff5407041a7eaecfff3afd582b69375c931c3387cb1a3f1986dd18e278f2dae0ee1b9089cb81b72ef54694965a4e1d17f7fdb2094ff5cd98c1de48ae9a649b10c447c604f8febef3052b678bda2f5d42203e17f0526b72e66527170b7166f0ed7e2634562db67e5e81b91fd64d5427ac7b8c50f63081d62fcc962a4af5a6ad6e295596295ed48ae12f1331b7179f3bd9c26b4e420389557214c8d56a498f8783982b4b7a3d0c5941b913055dbef72e56d9a1a3ff27ab24bb16d0408aed306bebc1388259ec6ebfd72477ce0dc478cd98d9e61d1ed71f642e65b06714ac02e91676bc30b7bdd675a5e82732cc59e09a8d9a37d20e5adf504cd4687fd7de626d1a2d1e70d1f9cc62972cd028adb53cbd55e61d0dd83a2d13d73349adbdd6b298ad2a1a765ef95dab3c9866942bbfdd459a340e0500032b63a2f5d14130515afedd5508e991f752ca0afd5501abf34d2e10159e0ca886a0cea3ae3e836e289567cd41b1ac46b2518848296626ec6d46d6d2104311d2b041c89d225c8237bf2f825277b403fbfe144b937307cb09c40b523ccfcbb28b5414af3dd5a239844335fe01e2e59c0caeb8d35cfe76d4451e88c8ed34e184683983ea8427a51bcfd4beb2ac3a9d047311076b10d7449f6ab98f6565d8a1da743599b2eea522fdc89d0173f8b4f147d774d417aae7064fff00c7ae5eb57ab8ff856394decd84b7793ddd7872d93367699d64dd86a5ea1df8d057698b73ba6aa7fb56675956dd33ab6b78d729b759e37a7d61be266755f29f6bf76c4d1550bb6dc07cf181aa9ec35e5beb505613de2e808ea81323ceeafccade0dee7456f34381b7a9fbeb96c0101ffea0e2be8849ca1e0d09753ea8a6320ce0daca77ecf518554daac382757fab5b81f5c55a473fe63ad2a6c306844fe1171815e47bbcefc834010271302ce2c60cd16c2a280d5e65caf38ae87f75bea57baf31c6d6c7c94cf352e587b670dc88c40e2dc68bb7f113ad20c8e01bc65cf9810979618df5578f1cac6c486d7c5bd7c04fc817478431c1048fc9c59fd08ed0c2e1496719a7bf1268175fb5bda450993312910ad2d020b7f5a66e3a077320c6335832f62e389127a03b29a24b3934e32c61ba7e33c984b751aa0e3a8ec25cfc124126d4a778b1144e58539d46ca55faae2c7f24ce4b0353fa2526cc10828f156775d7b6a2eea75cdc7d51e76402823f75a31293994bb8ee73aa0231fb853b0e319b4d3ab5534f7d144ad90c9c95bed2545e3fd899c79fd7776b27fa4e54e186eeb062502e1e5ef25a1c67af517eb26bf8818c7c552721471fbaa7370117a0395e69a8b08c8e67dfa99fda98225b1ca2ddc08278c3b938eb06d55fdee2f505b2cf85311b3898d9df996bf7a99e41053eb51f6935b5c362c971047e9e0e967ae7785812193ca10f0648752688e6392a371fb010c7ea34ec624022f879144b31ed2627f4c46f9989f2bf2cdfee783187a485d51e2dab76444dc05eea6094778e0bca4843aa14f8e627e5854a8c2a8437b83310800160ee1d3ed2c0bc2985dbe09bae1b9c4c6dbce14f1e5b55a999eca1c24e8521c2aa4d9804db7eae8420b8d2f52bacfc5aa8eea1f3a3f3bbc1410cfc43f25215b5d5e649f05703d2707ea671adfa437be72a1e83b51a6ad2d4eb9d78c5875d3301f335a1bf55ad9dce5d7b01482ac2218724790dfbd03f41e8db5d2902a20f41a7f5222e4cc7fbfd26ae55189570bdcc8c942a5d4abf81b177fc28787a8e127b95aed4ff7393e7be7cdcf6051b52f1b0ffa353a62b0f5a63e447d76bd5c779178eb89636ff6ab1da1ffdd0df471d55244362b3a6f39bbf4040763d6b61d0f2699b5ae5aac1fd7e392a5e7ccb61712adb8dbd59e2b80b731a2a1a1ca251ae678632e47b16d7fa6c6e75001d9298a8888fb9411179e2536d54554b218ae38ac8b2a52a1edf2a36b3603a555b29bfa4a52c89f8af8770e3ae4cc8ae2fab29f30c48590d9face2b9df683d9963abbe42621b58d7e4337e2c5c27527f977adc871209d19d1102bb09aed687a24c53e696c43b6cb032ff40f985b745cd87d35a2c863c5beb103796af48cf48643221754485920146ebf7eea582f0ca6007f17ac7f56b8d5e06548f25991185bf400b3b3213ad6639f27c3cb2820b88707c81fdac2b8bc95b24bb93e11741e5ff1b5e3f547360020938d6d8cbaf667f4525d085508d6b3201f0d1ecd6f6f23e2d90cc2d629e7aec9155b7c649339a2ffb2f9ba274e57f3ac58ea773e4be670f9c37b5ca221193edb294ca91d2c1bc86982d01df2196fd9f5e347617bed49ce3d8964d868f0f72126c7191c92e6c13532942f7d1502f1cf3245a726bc73877ae95d1aa5e1adcf06e4f51fbd8d6cc568b35231c6c24fd3a4381778770d0550e687361dc8a13ebef5b48030d2f854c7c3d50ca55231d6cda62902a281dcbefd8ddee49ab97887bd84e43dde5a4b8d9a1e09defe211353956e5b9c3d087186f2f8252d33ee691b2572492aef6ab0f830dcf295bd93746615be0724b5cbae00805811e7286faad2458ab8a4a036cb121607dbda647e22ba351cf506eeb2d6c016246cedc3e6bd6888746c6631b65a233ad021dac3dd335853bd577b37dfd929014395ad324b4773b411310dc09f8ef9701f2c7f4bda4c657110717ebd5c888da6ce4c18eea8486d2e5559e770f3d0da9dbec81d0b7d32e8d87ca93844da27e8dbf5e51f73c3b1dd5c8b310bec882f59548c91813de1478c0d2d9497f1231753dab435f1c2283789e313f67cca8da152479763c9e928394a6ab47cc18acf6792b80aafb931d37ba74f8fa8f7fa6e69ac7dd543a5e09e5b98fb8f2d85925fbd556bca78afd837acdc09e4c2b126bd750fbf55563b2bcc439f0329a77aba318fa659c7312679a996277832bccd3f36aabfcf8789e4a643c5aa447ba14b5cf2f92fd42ef07249c7abc120f179bd7393eb2ca96cc27ba6a0372d14f9f52943cd6d3556061cbe1cae8d7ab4c78d5a18d6424588e9c8f55e8435becfdc3da4e9aa62e123f06c44bf59735de1df6634d213a6503cbc9376480d94791363653bec986362bb80d5ae6ffdb57e7190378492e01e9b470dc81fd27455e187a832a6a61c566811af98a28b71af2971cff1781f1c7d1b81186a638e7bae585c62f811069597e14cd43723e9bc8ab619c1a5029e294d0e5612e21c0506f1a156556dc29a451badd9735b6e7843734bc2ceb5bf3e41833f5edd7a2dfad3aaaef832c283b7ea3f1b0e3a1fc861c455d1b20091acbc9acbf8bdedcc124fc8f426f78ba519fe91513d52d3a7c1dda5be6c07878a05e4adbf0c7903f0ad17d8c621364babb0767bf3835c5f6cc5c03cc54c1636efc1e3081c1729726ffa02bb8d945c1193ae32ae16f4da154fa8298ae825285c5a0dc14d9aa316e7754539eaba752288b4ec9082ad110d04d904d5ee2ef8d03951eec68d107627d8c9f5d2c43e09c4e835dcdb09d1f8387cbaf77b643cf3862a9bbccd8680a65301ddc0d87d809fbbf3e243156e4ef87f79a5e040144422f02a1382c70fa9b7ffe1da43f63a153ddf37725cdbcaf877c94b0ef43f7a2040b42f5b9ec69af45f69b305137616ae16ccbf332136815abfe4d60d538c210354e88bc3f62de490af446511f972851422d425e9b96a8ea3116e4691fba71fce5dee831e242fc308d18587c2406b346c114db21b8fa36546474b03c035997cd71d32248cfde73460a7c2d9d5e18518fe788b83566d19601d4f4a5923d82faa9d1e79fea07ee9145d7b166f2ca292ae7a9ba85563dad0c460bcc19fa6498d16b77d406de353dabdc96dd5078b1a7ed02024638f1d1ba0b801d69a581fa6cc93baf98ca52d48033d98d43b15ca0bd81dc00dd1204c145863f6af61d4e3d970786d6f4db7c7e53e659ec954a6ab478b2e83d1b1ba71f76ecd4b2a11c6b04d73a92671284b7d273289bb9bafbc4c6c7d6024c63638e5c630f7dcfacad63b09dc7b8a627360f67fa838602d854d02bdf3005fcc3aa11d318f38a46292cfad9707de285eb70e509032c48ffba7b8c04b2836cc738e49e42608aa51f52266a311ff4f16ad1bad5b617d679f221ac9195d2401d759d032e960f7f4eea89ae9af1cd99b32f5dbd761ebf458fb22feede31eb7daf66522058d9d1f9ab9d5ae0189f9bd95751a5c963ab079d3728514c3baf14f38d2876df8bc26ebe76aeb4203ddac10993216afddfe802cc6fb007abb74649f57464d123367c88d3a5df3ae8b30d77d3913df6033719da211b51a531e6f25cf8cb0e796f9459f513c967b8e3903dc83ddb0f6a10ca5d21e00b3a6b8b04843e8dc57e2fb718d7605da7a2d48453ebd5b51550c1a8888d8ce7b696807abf757923014d8efa89966e0b2f0b89d00d996581abf4207224f521dd3a1bf9d2a130bb69658047d232234ce0af826f5b8b5adb26f307b7327ab942424a6d2feae79193189ab1e018aa9d885a865f1d889f366a05d1cf001292922895af56dd532af888d552a8d4e25bcf3dce0dea82475133b577f41b9498470382367b9c5e528fe998f24df31e66e4f75e56a3621011194a0b8a346c5f159fa4366db59aa258e71c46fc8245714d79270ee0ed11ea836cbbcca4a936c37169f018b209de5df42885bdce79f3519b7a58615d4898b159b7c6defcc0b927999993f00a9906387350e1aeb257d99d5c2feda268289b38d7a5412e29e9c9e59092d50af3819042aa29bd668d88410774060a1869cd9ceb0413562412bccaa9c94dce08d3a20826572a47e28ff95a9c8eea9927607d9028037bb4a077e3e88c7650e41844fea5b97ef382a21c113a0506db5fc8112f818d775d42ead88b5cd8a3c63b1acd09d59d188fa9689923ddb479a31e478a50864e624848f880d1fd7db2e5223ff2c308a5e95e1c0856eea7cd605789155e5fd250cdd90ee6328446b549565a669d810e9607d41682abca5f29be8d609ebba3cf777a2c8418e915e71a278504d41893d630f0f00b26b5cd438b318197ab13c6a85ac201cabb06535a8b412c8c531afabe6a4265bccacf84c85c3d750d12d37c9f972987c4a6d4efaeba178014a1ad5ac312fb735a548b46a75b035543613ecd545f88e0e51971d8c8c5d572a21def92eaba1a3e22af04e2245accf6074b27d71dbba883d9799688413218a79192088e2f99d86f551d3ed99d0b5ea802c0e4c144d2183ce30e4c5438aab764b271813961e4a59e7eef1a0852ef3f82c7c1eda45115fdafa9d68cb696d2554a47fe277316d6fcdf0c5e4dd1c3c52e61a8bfdb00094ee75848c13fe9e23deb268bc431b1a1b66033fc2cfdc8d18152b6cfc8c9c320dacbd914eb55925fe412ec03bd7f539203fb521006355d0db38d5a832403ec83c1b961969631812b3411aa9b0a281ee7a1931567145ad50f23097492c76934d352cef255fb3304a0bdcf34457fa633dded93f9b05675f1127f65c28cbc9a7be03e7ead341d2fa99e3af6f571f5105f5a5510e15e035a4b4c5cb12aaeb2ba369f95173c7c15874b19eb31f8ca80015c6a33a311024434b121de302ea37671b505e09267ff801ef1a34a067bcaa750e0da60b9dc9132094495c5dd22b3deaf421bb7c9af691096683cfc5c484b6da6c155fd527b6a002b177eb5eff72e8076dd31efa04cb62928c739e2bc88783bcdd07ff724e1ff4561443d181af74c432952e7cc36f9f3d093d94fb85afc4a94a3c04cae72568bc31429d67ac767d6fd91184b3830b488cdbf1ba465997ce33a20b5607e8ea3033c1fb237a3ce9b133de4d8fc3c639b7827237fa051175f9412402a43e9bf3267231ab1deb1a2934db857907414023966c1d99a0339b8fea38ce11e479ebb92bde09fbdefccbf862d8ad15f769e714045bd60447984d100b2a0dd23d2e1fbe16cfe2582c82960413f7e0700323418aaf7c3543899938a97a474677a9eef07365e2e55b17c19183c907082eba8e81613dbcbd8f1a8e0dd5298de5a10dfabc2a770921e4aec1e549e27b6018ce505635225aac7804309e91f64492708d97969f43666bf2dac5e0ce3d178e7ac7b707bdb83e9b7a85bf0b5a9d12f883ba650fe816ed2cd4a29f1a28c0ed71acbd4d8eaeee0bcefd39c81124a573088dcce2abe811b00f62c385d48196c115b7390a6f2fc129fdf9c666313c931ba68ac168605ea9e375e6053be7eb9c24abd84aed161e3e85422a5438d264539c37b1eab9aaf747ea035cd3999d723b5414f6abb8677c91b5289b863227efa66902d8bb3450b3d99f53fa3df2e0335791ad8134fbe004727caaaad439daf613e4f3e9d40853bab3a5c72f15a05804198bc83d1065a25082524d827a38b6084943c00c6493c6c7dababd71d6389b8145822a951d58526559e959ecc21891a68764b59c523f46b589e8ce6d34a8f5f9636a558480685726185a6c5ee83fa7b0f411513599e17a0fbe59e0aecee83dba05496cf7cb1b8ad0e3c88875b995f662cc6e4cf2d2680b8540b87e6577c11afa0d95de59b51dd4d760a19051dcaad49e73de1f1f927b5f9a12b879ef9c03a0b92ccc36efb6fee321d1cb33bd0f460b3861c4e98c6f6dbaca20fd937204efd8a90444850720609ab105920d1e707c067ab884286dbf292f2f67151a810f97822b6806aa9d2bb164361ae29f62e7a87fd3adc43725a886d83210767c6273d924e6c31b9ecd3cbc23bcb784f86242603ee9158227569126b28dac3ec9c2a46b69bea869ccb66ac11e9c423cda1d82050055808247c8597360cd30c1ace47914e95916f9724ab6ebd2515defe70102442d48a72b19129fe3459eb8bd108dd18361f398678d5de83eec7a669f0de4d916121faee0d64ffd54b347b6d212ced398469cb9c6336227dc4345d2cd2efd344244d5b6e92eff8ebed529e23960532bf25cf0322282fee9a50162fb4ba245f306e691dc7d8660a60ace21e17239801e0120bd6cf4a2ba68d59cf2d22e4dbcb2047ac1444cea00859933f396e5dc2251c8759d74ea1cd0470d65f8f34b2a5566c61a2b9c369787b86069c5bc811008b3b1ce7635ac9d7bcbb45ef3ffc6957e6255e89563baeeddb37a11822fdc597b926223fc65afba5a8933c249c6a9b384e2fc7073a6a7bfc848b3926ccf4b7e57f1fc235542c0f68fd3950b1b2dcb34af013095c9f8d27353d2397672ae8dcdf081a9ecdfb02c822270e7f5df9556ee8a91e37f1b6865776165c28746e008d5e341d3113961c8139eb7aa7bee7bd4db4bd1f661c5e511018d1bd633ebff4b792124b0f917814fca1ea2c4e8dcd465f56f4dfa6929b170300dd207cf210e7b1070a353e8db853bb4d57af83062475b26bf6a31c8d9147c77b2dfa752b8d2077c3dc41137fa0049e34712af58310ac432c2bb272133b4d5239d23e853af4db1d052609fca67dbd9ec48f8f564323e931b1b235ebff149a9cc232e3d54bb7f1bc6b2667badb7f94a2b161e67b4686d9c62e1bcdfc6be47916493a08b791592e60b34a9bdda810c5d7ffe9db86478a18d954ee788e06d8d8bdec94bcbe722510cb9847c467f2a1ff36e0abc960627730db27ff88f51227e9f048bb90421c983ea4b92f9bc8f36ed43f96a0138cd0ad8889f333327555a76f1a283c8a0c1aa2a922aa483ff85fdb32c47801aba770e26da4fcf5d85362ec5e099a5df424a0d08c143ef83d428f5692fe0864d21186c063e53e6e040ed9c028772a7f90d67d06c3dbeaa4368a2bd0320541ab9ce48d10024df8dc516fcf5e9cd26e03509bdb5c5438a8f4c6a8b028ddddf81652c00aea87e5bc7436b67afd2a1cabe5d5049350e5e461ea0e084f6dd0626e1ac3a9028c39a589c3a688e782e11720f2061e018cccca5755fdfff0ea406281438147b5afbbe0daabdd68fbb040caec3c0ca2559d5b695d4cb979e94cfae9bb70ad51990cbd3273efad676e441f1ac28c55ab03d76ce057c2adbefb9a1dd9732a2bef9f259a52729edc59f7f7bf4043c69c5138cb4c245db440f0c0c4f4c72369f7bfa6d9f61b67c071937b1c0fde10aa0a18ec8460506a4a26a987e69d6f1f0314c1117857038a67d9ad48ca97a8688cb0474c6c0b0f2a3e599ed715859cbc05c4c0f4c6e8e6f527a00dce35c8bcf9f299f73fbe246d2831a1194b51668376917c324c53bdb64681d29b5f996a2609b70e346dd7e0ba36b7f26008f0dc157241ecbde8e8555e112309ca75d18397911b61ff7e0fdfb94bab2e4c22843afef53d3a8001d640442c6fb7e336b9340c8c23f530bd5c7b4194f077d849bda5745e6d379038c26d189ea1c961a33bdf29c640c1f4aa86908a9923a5bd79dde42b49818090f1fcab238e2746e848449c160acfa7edb901b5557654f012b6efe684260a5d527bd22fd7e0e19372da42fd80a1ad27e29254f9c12e39bcdb00ec1d556b3f864d8ee35e725206a0efc0b46aa34f6f2818cce1480993091ebc1acadce28afdfbc56ae22024e4e23002e7ad776755b8e031c8fb694c3c9bf4b99dbfa86d2f393e26e41be57a14dc5143b1dfaa457a1a84b7a2d799177ac65f92903689c096e0c9e74289e878501c76420907ca5c3532fc8790e68c7a20d08e931e425fd445e1ee8fcf98b7c50e50be31be8a8e8b66c7692a6cb3f7b8e93c42c2274bb42ff4a3732b020ea3a28fb47086c882fba8d2cb5de34787eb9e64ec06da93be881ca3caff2bd42e3edea3cfffa5f123a3c23d08543a74764c6e6f1ca6858605c6fad58b482bf4011f8f583615ba7c671905b667661018432f5d88fa5abb858652cb0f968343ab57393e736d6795f463d12dc64239d7c08bf3b443fc3db0f9cc29761c73736a32488b8c47abc9e52258de9867544356b26a9581cffafe9ba7dc68b520c1249b162d6f930418a5f69d76a66a32f8f1cce772d9764407dec579cceaaca8b8d0f0fcbd0c9e1e7d0e916f036d97d9315c6ca3e8ef1fe38a9aba01c99f9012c8e085f4d0624bb325bcb721ec677324d8cb2d12405181beb5f2b916a9ae83fde891b41aa81405f341b9837d7202e8d9abd35fcff020eac9ad2d874ba7c51914f65ad269da48bb98fa2024f082f637e43ec931c23e038c315d296717ecb785dfde72880cb8c7a6eb8bfa75b4a7d8c56379b555a557ddf51b1bfe4dff32658f993306f37687c1cb2d957e4ed4f58f5cd19532f3c8d8d65963a01ce2cc830232fef8ac7d22d8c9f2b2f775ed23bfedb34464c94478f810ac9eb0cc8059019e121f2aaffe1723716d121243fa790d0d450b2fd7b0e484b023be384f157d0cc2a30e0488bfd0ba13b4acfc54e5ed90a4e354b8eedeb341a4f71d24b7b74c56a2111a8c1ea4adc657c4b35d8189cf854279a1515e00bcda61a4505ee0e6af8c724aa382356a59d34dbd1491e61068c7d3cb987717db68604619305f4056fb4b4281563650f1de0c802275397b5478df103d1a65c7c2590719047f835377a04474767ce40d0deb9f0d30597fe2c4eee045f31fe41810e2751f5199a15ae29169cdaaf12a13e968358fc28a07bcd34f290591d8d97efe073a4db864b7460b55da3a9c48be75c91510bc8fa16c44de4b2a278bf5c32d07d82ee8700953a6d7bb759a2deef7fe84734a8c1f504685ea264ca47b3ca92c525aacab53b80c7c3ba2f603280bfa0f88ed2983695766bf71c2ceb22de6714d6e39cb0e45491c242af9e41977e0caf29c68f6cb366d14b43c1525c7857ec6f7b9cb555f92b7655820ff6f42aa17733b1303f2323f8eb4930ad4acc1afae1794afe34bb9b0f212573ccfbad3cfc6c907c8c7b58eb4ed31272a526a1c16bdd674894c7919eb7c8ad9e431b740e79e0e2ae911753ff8962aaeccc2640de3185bde72030de515aca375978c0caad933f6da840847d5345f729e0bcdde9cb6def34e32b5c919b693651fdddfb03dbd4743632c2dba3cb28ce1d88a9803e437a33d562dc5c8115349f7b352de35de0145d3859f11376cf4a814840b6f79dab8faf5052615f7adb089c77c2b9d3a83e86e0c7e777b62a06e3633842292d5f5c75ab507ddbc2bda6176b2d7dc99e26c374f8a74b43c54becb717f4351a6346c530bb626de08b783466a4fc5d8d04b92bb2b4595a37cdfab01a9411b9c048d5e0875b93b4f1245f887e8c878281af3f6415614578838f27974a672edc36e989f22864179b198083a9aee3aed0e69f52b33b864b5b2c908e2686ad2aeb3377500e87e051970ca4b7a794aef0c01274c66b0ae0225f1bf19ab362e42b577dc55da7b4cb4e9a9b1c9c32125522d0e49cdc38b546a8c582e94931a43dc51b7bfc3f21da74bfed2b65ad148e06f8bc9a35a5b66e50e69c6a63038fd8aad1e44e1e868e5806679bafafc12c435e213d22e3244700733face64b456ca45ace1680817a5771540cc940f03806d9725db581d5fbcd54b909dd53df338dbce2bd85f1d2b0677f49a115b5772fbae1f61b0437365f08772fc8a37a91df0dfacacd1ef4e7fb528e920b8f3e06e999ad0d634993e9d2537439d22a9c25c843ff0ba8e12cbc27d327c00a4d3c12bb84065ba9243c060fa530a06f56ba68e7afe459ac38c29227eaacd729a6574cff8fc10f454d669e8b9502baff7c1743b50eb857226cfc5a438c3a5719f723450eafe76db8cd232e8f3f4fad91ddc77897dd1d84d5b8475d70b7aaba39d0449a870ac444d3c1a45a8beec6ef844151f0994b3b452111a0e10c1acfad816a9d1b8c6885fdf03dd3cfa35913599cc14f504c1beb89522d53d8d11a27fa6e0e8518215a50f23b124abb3e6f6e38160d7f8777b6cc7c6f5ab8c8862aea7dd22b22e9c6d9cc66c32108fc4077ba44ad3b3f96a21ea132ec365099b152a1f11c42d49012eedb815112f9da82051d9ed513751b631e95aca3036d13ebd9b731893403f19544e6caa45df7362819e1ba4bc07bef5ff1eecc821463608ed2af53988d96d80c4f47ae77909685521b392e2eae0e7ac8311bbdb1b27cb6c7aba681e3f23db3cb6a76f311631e9081461c280c2130ed698203b5c3b287fdbf4f7dbad7fdcf4968ff02508be606dbfde935963aa22831c6db26aeedc5a88c95c4a3a024c576ec89958ef1b90ed068c7c59204a7aaa74318cb2f8dcd5fa22069a6800d843dc3bd5bd8a887597cecb5edb4f5d107d665067a3e1a73f0fdf8fbb742375ad9ac165661c10ffb6ec2b4d5cf5e329861e74507f62e442fd6ca74cbbccef38aec70b76dca9148d649ccbcf932dbd9affd3647aa335a8ecc9545008cfae3da09c35d45a803eff4010f7eb878dbf953799800fc416e638fed6f838efbc34f3e8f07af68dfec303554ba07f7c62e57c2a1bdba13546f5b3d9818656949bd2a2754b8c54826926f483a6cce289352f36c377efc8983e43d39fb90a0f8e9531d5730bcbf1f35088d8a59f0d833b53610fb16f2d1e4437e10bbf446d3d1472ece37f23bf662149c3d0207144d60de438998895cca036d4c354de581a24d25f9da5f42802a24bd78fd9c4e7466d0934ba0c0e5438a090d251a24f6acbb31f5e656fd0535f14b092827d12d57ffefa91ca5dd003eae04ee99e6cc1764a9ae26183cf3bf07f5a8aa8ba996e18c30a606da869fbc423939bc044c0291639d882bd029654469fa23ae633e3bf300d34935f2ad553dd5174384cf56a4e9272fea1c97350e70394e0e724c2bec10663d4fd4231308b527a081d08f906f4e5930e2d593ed16800e4938c76c25520d78281cda16ab4be9f21ad1612c057fbfb6977edccaf9b865223894d4cabab19c032888a840aea1e2ea8ad7ac9346272ce82653ae2235caa1a452d37d7c4e5e64007bf370e7de42f1c46c4a8a87be67aece7781fb2e3ba03bc1d2c0b8993f6c98ddb6a0443aec10f18e2ff3f668a67a0e56fe2667b22cbfbec4ad84eb2b6bd986733c8eb4ce02014d60a50b4950a72c36f9eeff1bf3a4d71ef0b2ce4a181c2fde72d11179252f756bec2ffbdcff73c75384a631fa3d39f1d02cef7659b1d3d71556e0a1bc24c43681b5a9913fa613ca552cb4288a24388910828c584731122d9e64b8daca89a1c39177a8cda506b46594976834b3b95e997acee825bf0bf6ce0adb4006fde1b1932bc1ac4acb01089e7633536ed146e4a719fcde436ab9bef5b4eb51aa12d121c625bede8e5caf7faac2673f3c0388661d0a922fdb4efa915abadb5be1bca8e99e18644c306c460bb4ed0b25d22bf63ac8c57a859ba9b6b15e81b6c532be9693893d0830e12da60328e7fe5ba5e41bbf192d2ac894522457ed73febdfc5292d9c4918d77f0eda60b6de06cfa2b4d254ac8f8a46c395877b5ddee4a851d737da383b7b12eda410995f206bbfbb3cb7f85833f69ded122a806ec84308edd941a401f664b2814142b8caebccd4ff01603e7907d40023bfc1fe1f63ca63876af84e6c7523e0a2dc895a5af534097fa50ca28decd4d80f9b94e4930ac348eac4923bc92cb601024dac6211a0f6f177cd6147ea197a2980d3dfd7c7737928e43b07dceadbdb84623fa7ecf7dd0340cafc4534e9092256d959d5402627f2a762d4e1fba7f245d926367adc852bf2dbe9eba41ef32ee3fa8aef47d8b68e55cfb443bd22e0611d95d22f1183d309deb329048f480a6063cad77d02fd30cb4ac3c69952b3d49a36e75d581d9573844ef22247d6d848111c98b77bc5e6dd233646d54a36681c22184e9eb5e4f77200b6e7ee5537e017d4acf2d5fc31690a814710d4039448a410cf14b0123eb24b43717699e5fcf80085e6a87256684c5f7a15561cdc990648cd4bc34a9b3ef946396252d193acee21e8370be8a944fd1dcb78fb72a1501fcb04df34a316f31e278b5a73dd8299d9a5e233fbbc2a4144e29f57d2988dfed5451cfe34c411e455bf89e3629896c29bb1d602214a991d178576509782c953b900677d40c18134"
        )
        val state3 = Serialization.decrypt(TestConstants.Bob.nodeParams.nodePrivateKey, normalWithHtlcs, TestConstants.Bob.nodeParams)
        assertIs<Normal>(state3)
        assertEquals(state3.commitments.fundingTxId, fundingTx.txid)
        assertEquals(state3.commitments.channelFeatures, ChannelFeatures(setOf(Feature.StaticRemoteKey, Feature.AnchorOutputs)))
    }
}